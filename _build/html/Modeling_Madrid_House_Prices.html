
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Modeling Madrid House Prices with Linear Regression &#8212; Modeling Madrid House Prices</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Modeling_Madrid_House_Prices';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Modeling Madrid House Prices" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="Modeling Madrid House Prices - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="Modeling Madrid House Prices - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Modeling Madrid House Prices
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Modeling Madrid House Prices with Linear Regression</strong></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Modeling_Madrid_Houses_Prices" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/FabioScielzoOrtiz/Modeling_Madrid_Houses_Prices/issues/new?title=Issue%20on%20page%20%2FModeling_Madrid_House_Prices.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Modeling_Madrid_House_Prices.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Modeling Madrid House Prices with Linear Regression</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description-of-the-data"><strong>Conceptual description of the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing"><strong>Data preprocessing</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-some-variables"><strong>Removing some variables</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types"><strong>Data types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unique-values"><strong>Unique values</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-encoding"><strong>Standard encoding</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values"><strong>Missing values</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split"><strong>Train-Test Split</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda"><strong>EDA</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-summary"><strong>Descriptive summary</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers"><strong>Outliers</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-analysis"><strong>Response analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram"><strong>Histogram</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#frequencies"><strong>Frequencies</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot"><strong>Boxplot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ecdf-plot"><strong>ECDF-plot</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relation-between-response-and-predictors"><strong>Relation between response and predictors</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-model"><strong>Linear Regression Model</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-linear-regression"><strong>Why Linear regression?</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions"><strong>Assumptions</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions-consequences"><strong>Assumptions consequences</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-representation-of-the-basic-assumption"><strong>Matrix representation of the basic assumption</strong> <a class="anchor" id="8"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-estimation"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-deviation-of-coefficients"><strong>Standard deviation of coefficients</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals-for-coefficients"><strong>Confidence intervals for  coefficients</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#goodness-of-fit"><strong>Goodness of fit</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#r-square"><strong>R-square</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusted-r-square"><strong>Adjusted R-square</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-significance-test-anova"><strong>Global Significance Test (ANOVA)</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction"><strong>Prediction</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-selection"><strong>Predictors Selection</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#significance-test"><strong>Significance Test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-ratio-test"><strong>Likelihood Ratio Test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-selection-based-on-predictive-performance"><strong>Predictors selection based on predictive performance</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#train-train-train-validate-split"><strong>Train-Train - Train-Validate split</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#best-subset-selection-algorithm"><strong>Best subset selection algorithm</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection"><strong>Model selection</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance"><strong>Estimation of future performance</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-intervals"><strong>Prediction intervals</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-theory"><strong>Coefficient Interpretation: theory</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#without-interactions"><strong>Without interactions</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-quantitative-predictors"><strong>Interpretation of quantitative predictors</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-categorical-predictors"><strong>Interpretation of categorical predictors</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#with-interactions"><strong>With interactions</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-predictors"><strong>Quantitative predictors:</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-predictors"><strong>Categorical predictors:</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-application"><strong>Coefficient Interpretation: application</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-problems"><strong>Model Problems</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-model-assumptions"><strong>Violation of model assumptions</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-null-mean-of-the-residuals"><strong>Violation of null mean of the residuals</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-constant-variance-of-the-residuals"><strong>Violation of constant variance of the residuals</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-normality-of-the-residuals"><strong>Violation of Normality of the residuals</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-null-auto-correlation-of-the-residuals"><strong>Violation of null auto-correlation of the residuals</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multicollinearity"><strong>Multicollinearity</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#perfect-multicollinearity"><strong>Perfect Multicollinearity</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#high-multicollinearity"><strong>High Multicollinearity</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#multicollinearity-identification"><strong>Multicollinearity Identification</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#multicollinearity-identification-with-the-linear-correlation-matrix"><strong>Multicollinearity identification with the linear correlation matrix</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="modeling-madrid-house-prices-with-linear-regression">
<h1><strong>Modeling Madrid House Prices with Linear Regression</strong><a class="headerlink" href="#modeling-madrid-house-prices-with-linear-regression" title="Link to this heading">#</a></h1>
<section id="requirements">
<h2><strong>Requirements</strong><a class="headerlink" href="#requirements" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#import sys</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">import</span> <span class="nn">scipy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#sys.path.insert(0, &#39;C:/Users/fscielzo/Documents/DataScience-GitHub/EDA&#39;)</span>
<span class="kn">from</span> <span class="nn">EDA</span> <span class="kn">import</span> <span class="n">dtypes_df</span><span class="p">,</span> <span class="n">count_col_nulls</span><span class="p">,</span> <span class="n">corr_matrix</span><span class="p">,</span> <span class="n">outliers_table</span><span class="p">,</span>  <span class="n">scatter_matrix</span><span class="p">,</span> <span class="n">boxplot_2D_matrix</span><span class="p">,</span> <span class="n">histogram_2D_matrix</span><span class="p">,</span> <span class="n">ecdf_2D_matrix</span><span class="p">,</span> <span class="n">quant_to_cat</span>
<span class="kn">from</span> <span class="nn">EDA</span> <span class="kn">import</span>  <span class="n">histogram</span><span class="p">,</span> <span class="n">freq_table</span><span class="p">,</span> <span class="n">outlier_filter</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">boxplot</span><span class="p">,</span> <span class="n">ecdfplot</span><span class="p">,</span> <span class="n">stripplot_matrix</span><span class="p">,</span> <span class="n">transform_to_dummies</span><span class="p">,</span> <span class="n">cross_quant_cat_summary</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="conceptual-description-of-the-data">
<h2><strong>Conceptual description of the data</strong><a class="headerlink" href="#conceptual-description-of-the-data" title="Link to this heading">#</a></h2>
<p>The data set of this project  contains information about Madrid houses extracted from Real State web portals.</p>
<p>The data has been obtained from <code class="docutils literal notranslate"><span class="pre">Kaggle</span></code>:  <a class="reference external" href="https://www.kaggle.com/datasets/makofe/housesclean">https://www.kaggle.com/datasets/makofe/housesclean</a></p>
<p>The following table summarize conceptually the variables contained in the data set with which we will work along this project.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sq_mt_built</span></code></p></td>
<td><p>size of the house in square meter built</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">n_rooms</span></code></p></td>
<td><p>Number of rooms of the house</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">n_bathrooms</span></code></p></td>
<td><p>Number of bathrooms of the house</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">n_floors</span></code></p></td>
<td><p>Number of floors of the house</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sq_mt_allotment</span></code></p></td>
<td><p>for detached houses, full size including house, pool, garden, etc</p></td>
<td><p>Quantitative</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">floor</span></code></p></td>
<td><p>Indicates the house height</p></td>
<td><p>Multiclass</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">is_renewal_needed</span></code></p></td>
<td><p>Indicates wether the house needs renewal or not</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">has_lift</span></code></p></td>
<td><p>Indicates wether the house has lift or not</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">is_exterior</span></code></p></td>
<td><p>Indicates wether the house is exterior or not</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">energy_certificate</span></code></p></td>
<td><p>higher values mean more efficient energy system</p></td>
<td><p>Multiclass</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">has_parking</span></code></p></td>
<td><p>Indicates wether the house has parking or not</p></td>
<td><p>Binary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">neighborhood</span></code></p></td>
<td><p>Madrid’s neighborhoods</p></td>
<td><p>Multiclass</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">district</span></code></p></td>
<td><p>Madrid’s districts</p></td>
<td><p>Multiclass</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">house_type</span></code></p></td>
<td><p>Indicates the house type: flat (0), chalet (1), study (2), duplex (3), top floor (4)</p></td>
<td><p>Multiclass</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">buy_price</span></code></p></td>
<td><p>The buy price of the house</p></td>
<td><p>Quantitative</p></td>
</tr>
</tbody>
</table>
</section>
<section id="reading-the-data">
<h2><strong>Reading the data</strong><a class="headerlink" href="#reading-the-data" title="Link to this heading">#</a></h2>
<p>First of all, we read the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">madrid_houses_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;madrid_houses.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 17)</small><table border="1" class="dataframe"><thead><tr><th></th><th>id</th><th>sq_mt_built</th><th>n_rooms</th><th>n_bathrooms</th><th>n_floors</th><th>sq_mt_allotment</th><th>floor</th><th>buy_price</th><th>is_renewal_needed</th><th>has_lift</th><th>is_exterior</th><th>energy_certificate</th><th>has_parking</th><th>neighborhood</th><th>district</th><th>house_type</th></tr><tr><td>i64</td><td>i64</td><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>i64</td><td>i64</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>bool</td><td>i64</td><td>i64</td><td>i64</td></tr></thead><tbody><tr><td>0</td><td>21742</td><td>64.0</td><td>2</td><td>1</td><td>1</td><td>0.0</td><td>3</td><td>85000</td><td>false</td><td>false</td><td>true</td><td>4</td><td>false</td><td>135</td><td>21</td><td>1</td></tr><tr><td>1</td><td>21741</td><td>70.0</td><td>3</td><td>1</td><td>1</td><td>0.0</td><td>4</td><td>129900</td><td>true</td><td>true</td><td>true</td><td>0</td><td>false</td><td>132</td><td>21</td><td>1</td></tr><tr><td>2</td><td>21740</td><td>94.0</td><td>2</td><td>2</td><td>1</td><td>0.0</td><td>1</td><td>144247</td><td>false</td><td>true</td><td>true</td><td>0</td><td>false</td><td>134</td><td>21</td><td>1</td></tr><tr><td>3</td><td>21739</td><td>64.0</td><td>2</td><td>1</td><td>1</td><td>0.0</td><td>-1</td><td>109900</td><td>false</td><td>true</td><td>true</td><td>0</td><td>false</td><td>134</td><td>21</td><td>1</td></tr><tr><td>4</td><td>21738</td><td>108.0</td><td>2</td><td>2</td><td>1</td><td>0.0</td><td>4</td><td>260000</td><td>false</td><td>true</td><td>true</td><td>0</td><td>true</td><td>133</td><td>21</td><td>1</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(21739, 17)
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-preprocessing">
<h2><strong>Data preprocessing</strong><a class="headerlink" href="#data-preprocessing" title="Link to this heading">#</a></h2>
<p>In this section we are going to carry out some preprocessing tasks on the data.</p>
<section id="removing-some-variables">
<h3><strong>Removing some variables</strong><a class="headerlink" href="#removing-some-variables" title="Link to this heading">#</a></h3>
<p>We will remove some variables that will be not used in the project.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variables_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;district&#39;</span><span class="p">,</span> <span class="s1">&#39;neighborhood&#39;</span><span class="p">]</span>
<span class="n">variables_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">variables_to_remove</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">madrid_houses_df</span> <span class="o">=</span> <span class="n">madrid_houses_df</span><span class="p">[</span><span class="n">variables_to_keep</span><span class="p">]</span>
<span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 13)</small><table border="1" class="dataframe"><thead><tr><th>sq_mt_built</th><th>n_rooms</th><th>n_bathrooms</th><th>n_floors</th><th>sq_mt_allotment</th><th>floor</th><th>buy_price</th><th>is_renewal_needed</th><th>has_lift</th><th>is_exterior</th><th>energy_certificate</th><th>has_parking</th><th>house_type</th></tr><tr><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>i64</td><td>i64</td><td>bool</td><td>bool</td><td>bool</td><td>i64</td><td>bool</td><td>i64</td></tr></thead><tbody><tr><td>64.0</td><td>2</td><td>1</td><td>1</td><td>0.0</td><td>3</td><td>85000</td><td>false</td><td>false</td><td>true</td><td>4</td><td>false</td><td>1</td></tr><tr><td>70.0</td><td>3</td><td>1</td><td>1</td><td>0.0</td><td>4</td><td>129900</td><td>true</td><td>true</td><td>true</td><td>0</td><td>false</td><td>1</td></tr><tr><td>94.0</td><td>2</td><td>2</td><td>1</td><td>0.0</td><td>1</td><td>144247</td><td>false</td><td>true</td><td>true</td><td>0</td><td>false</td><td>1</td></tr><tr><td>64.0</td><td>2</td><td>1</td><td>1</td><td>0.0</td><td>-1</td><td>109900</td><td>false</td><td>true</td><td>true</td><td>0</td><td>false</td><td>1</td></tr><tr><td>108.0</td><td>2</td><td>2</td><td>1</td><td>0.0</td><td>4</td><td>260000</td><td>false</td><td>true</td><td>true</td><td>0</td><td>true</td><td>1</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="data-types">
<h3><strong>Data types</strong><a class="headerlink" href="#data-types" title="Link to this heading">#</a></h3>
<p>We check the variables data types according to <code class="docutils literal notranslate"><span class="pre">polars</span></code> structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dtypes_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">madrid_houses_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (13, 2)</small><table border="1" class="dataframe"><thead><tr><th>Columns</th><th>Python_type</th></tr><tr><td>str</td><td>object</td></tr></thead><tbody><tr><td>&quot;sq_mt_built&quot;</td><td>Float64</td></tr><tr><td>&quot;n_rooms&quot;</td><td>Int64</td></tr><tr><td>&quot;n_bathrooms&quot;</td><td>Int64</td></tr><tr><td>&quot;n_floors&quot;</td><td>Int64</td></tr><tr><td>&quot;sq_mt_allotmen…</td><td>Float64</td></tr><tr><td>&quot;floor&quot;</td><td>Int64</td></tr><tr><td>&quot;buy_price&quot;</td><td>Int64</td></tr><tr><td>&quot;is_renewal_nee…</td><td>Boolean</td></tr><tr><td>&quot;has_lift&quot;</td><td>Boolean</td></tr><tr><td>&quot;is_exterior&quot;</td><td>Boolean</td></tr><tr><td>&quot;energy_certifi…</td><td>Int64</td></tr><tr><td>&quot;has_parking&quot;</td><td>Boolean</td></tr><tr><td>&quot;house_type&quot;</td><td>Int64</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="unique-values">
<h3><strong>Unique values</strong><a class="headerlink" href="#unique-values" title="Link to this heading">#</a></h3>
<p>We compute the unique values of each variable, what is useful to get a more real idea of their nature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">columns</span> <span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">madrid_houses_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (741,)</small><table border="1" class="dataframe"><thead><tr><th>sq_mt_built</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>13.0</td></tr><tr><td>15.0</td></tr><tr><td>16.0</td></tr><tr><td>18.0</td></tr><tr><td>19.0</td></tr><tr><td>20.0</td></tr><tr><td>21.0</td></tr><tr><td>22.0</td></tr><tr><td>23.0</td></tr><tr><td>24.0</td></tr><tr><td>25.0</td></tr><tr><td>26.0</td></tr><tr><td>&hellip;</td></tr><tr><td>1500.0</td></tr><tr><td>1600.224593</td></tr><tr><td>1619.87041</td></tr><tr><td>1700.477327</td></tr><tr><td>1800.379027</td></tr><tr><td>1930.501931</td></tr><tr><td>2000.0</td></tr><tr><td>2035.278155</td></tr><tr><td>2080.0</td></tr><tr><td>2081.332053</td></tr><tr><td>2199.874293</td></tr><tr><td>2400.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (19,)</small><table border="1" class="dataframe"><thead><tr><th>n_rooms</th></tr><tr><td>i64</td></tr></thead><tbody><tr><td>0</td></tr><tr><td>1</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr><tr><td>5</td></tr><tr><td>6</td></tr><tr><td>7</td></tr><tr><td>8</td></tr><tr><td>9</td></tr><tr><td>10</td></tr><tr><td>11</td></tr><tr><td>12</td></tr><tr><td>13</td></tr><tr><td>14</td></tr><tr><td>15</td></tr><tr><td>16</td></tr><tr><td>18</td></tr><tr><td>24</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (16,)</small><table border="1" class="dataframe"><thead><tr><th>n_bathrooms</th></tr><tr><td>i64</td></tr></thead><tbody><tr><td>1</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr><tr><td>5</td></tr><tr><td>6</td></tr><tr><td>7</td></tr><tr><td>8</td></tr><tr><td>9</td></tr><tr><td>10</td></tr><tr><td>11</td></tr><tr><td>12</td></tr><tr><td>13</td></tr><tr><td>14</td></tr><tr><td>15</td></tr><tr><td>16</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6,)</small><table border="1" class="dataframe"><thead><tr><th>n_floors</th></tr><tr><td>i64</td></tr></thead><tbody><tr><td>1</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr><tr><td>5</td></tr><tr><td>7</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (356,)</small><table border="1" class="dataframe"><thead><tr><th>sq_mt_allotment</th></tr><tr><td>f64</td></tr></thead><tbody><tr><td>0.0</td></tr><tr><td>10.0</td></tr><tr><td>20.0</td></tr><tr><td>22.0</td></tr><tr><td>25.0</td></tr><tr><td>27.0</td></tr><tr><td>28.0</td></tr><tr><td>29.0</td></tr><tr><td>30.0</td></tr><tr><td>36.0</td></tr><tr><td>40.0</td></tr><tr><td>50.0</td></tr><tr><td>&hellip;</td></tr><tr><td>991.0</td></tr><tr><td>994.0</td></tr><tr><td>997.0</td></tr><tr><td>1000.0</td></tr><tr><td>2000.0</td></tr><tr><td>3000.0</td></tr><tr><td>4000.0</td></tr><tr><td>5000.0</td></tr><tr><td>6000.0</td></tr><tr><td>10000.0</td></tr><tr><td>11000.0</td></tr><tr><td>21000.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15,)</small><table border="1" class="dataframe"><thead><tr><th>floor</th></tr><tr><td>i64</td></tr></thead><tbody><tr><td>-5</td></tr><tr><td>-3</td></tr><tr><td>-2</td></tr><tr><td>-1</td></tr><tr><td>0</td></tr><tr><td>1</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr><tr><td>5</td></tr><tr><td>6</td></tr><tr><td>7</td></tr><tr><td>8</td></tr><tr><td>9</td></tr><tr><td>10</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2_403,)</small><table border="1" class="dataframe"><thead><tr><th>buy_price</th></tr><tr><td>i64</td></tr></thead><tbody><tr><td>36000</td></tr><tr><td>39000</td></tr><tr><td>42000</td></tr><tr><td>49000</td></tr><tr><td>49500</td></tr><tr><td>52000</td></tr><tr><td>52990</td></tr><tr><td>53000</td></tr><tr><td>54000</td></tr><tr><td>55000</td></tr><tr><td>56000</td></tr><tr><td>57000</td></tr><tr><td>&hellip;</td></tr><tr><td>6500000</td></tr><tr><td>6750000</td></tr><tr><td>6800000</td></tr><tr><td>6900000</td></tr><tr><td>7000000</td></tr><tr><td>7525000</td></tr><tr><td>7800000</td></tr><tr><td>7900000</td></tr><tr><td>8000000</td></tr><tr><td>8500000</td></tr><tr><td>8700000</td></tr><tr><td>8800000</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>is_renewal_needed</th></tr><tr><td>bool</td></tr></thead><tbody><tr><td>false</td></tr><tr><td>true</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>has_lift</th></tr><tr><td>bool</td></tr></thead><tbody><tr><td>false</td></tr><tr><td>true</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>is_exterior</th></tr><tr><td>bool</td></tr></thead><tbody><tr><td>true</td></tr><tr><td>false</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (8,)</small><table border="1" class="dataframe"><thead><tr><th>energy_certificate</th></tr><tr><td>i64</td></tr></thead><tbody><tr><td>0</td></tr><tr><td>1</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr><tr><td>5</td></tr><tr><td>6</td></tr><tr><td>7</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small><table border="1" class="dataframe"><thead><tr><th>has_parking</th></tr><tr><td>bool</td></tr></thead><tbody><tr><td>false</td></tr><tr><td>true</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5,)</small><table border="1" class="dataframe"><thead><tr><th>house_type</th></tr><tr><td>i64</td></tr></thead><tbody><tr><td>1</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr><tr><td>5</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="standard-encoding">
<h3><strong>Standard encoding</strong><a class="headerlink" href="#standard-encoding" title="Link to this heading">#</a></h3>
<p>We will apply standard encoding on the categorical variables.</p>
<p>The variables to apply standard encoding are the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols_to_std_encoding</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;house_type&#39;</span><span class="p">,</span> <span class="s1">&#39;has_parking&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">,</span> <span class="s1">&#39;is_renewal_needed&#39;</span><span class="p">,</span> <span class="s1">&#39;has_lift&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols_to_std_encoding</span> <span class="p">:</span>

    <span class="n">X_std_encoding</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">madrid_houses_df</span><span class="p">[[</span><span class="n">col</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">madrid_houses_df</span> <span class="o">=</span> <span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">X_std_encoding</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 13)</small><table border="1" class="dataframe"><thead><tr><th>sq_mt_built</th><th>n_rooms</th><th>n_bathrooms</th><th>n_floors</th><th>sq_mt_allotment</th><th>floor</th><th>buy_price</th><th>is_renewal_needed</th><th>has_lift</th><th>is_exterior</th><th>energy_certificate</th><th>has_parking</th><th>house_type</th></tr><tr><td>f64</td><td>i64</td><td>i64</td><td>i64</td><td>f64</td><td>i64</td><td>i64</td><td>i32</td><td>i32</td><td>i32</td><td>i64</td><td>i32</td><td>i32</td></tr></thead><tbody><tr><td>64.0</td><td>2</td><td>1</td><td>1</td><td>0.0</td><td>3</td><td>85000</td><td>0</td><td>0</td><td>1</td><td>4</td><td>0</td><td>0</td></tr><tr><td>70.0</td><td>3</td><td>1</td><td>1</td><td>0.0</td><td>4</td><td>129900</td><td>1</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>94.0</td><td>2</td><td>2</td><td>1</td><td>0.0</td><td>1</td><td>144247</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>64.0</td><td>2</td><td>1</td><td>1</td><td>0.0</td><td>-1</td><td>109900</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>108.0</td><td>2</td><td>2</td><td>1</td><td>0.0</td><td>4</td><td>260000</td><td>0</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="missing-values">
<h3><strong>Missing values</strong><a class="headerlink" href="#missing-values" title="Link to this heading">#</a></h3>
<p>We check if there are missing values (null/NaN) in our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count_col_nulls</span><span class="p">(</span><span class="n">madrid_houses_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 13)</small><table border="1" class="dataframe"><thead><tr><th>sq_mt_built</th><th>n_rooms</th><th>n_bathrooms</th><th>n_floors</th><th>sq_mt_allotment</th><th>floor</th><th>buy_price</th><th>is_renewal_needed</th><th>has_lift</th><th>is_exterior</th><th>energy_certificate</th><th>has_parking</th><th>house_type</th></tr><tr><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td><td>u32</td></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table></div></div></div>
</div>
<p>There are non missing values in this case.</p>
</section>
</section>
<section id="train-test-split">
<h2><strong>Train-Test Split</strong><a class="headerlink" href="#train-test-split" title="Link to this heading">#</a></h2>
<p>We perform a train-test split. Along the most part of the project we will only use the train part, since it plays the role of the data that we have in reality, and the test partition only should be used to estimate the predictive performance of the model with “new” data (estimation of future performance).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="s1">&#39;buy_price&#39;</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">response</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">madrid_houses_df</span><span class="p">[</span><span class="n">predictors</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">madrid_houses_df</span><span class="p">[</span><span class="n">response</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="n">X_Y_train_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">X_train</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y_train</span><span class="p">)),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
<span class="n">X_Y_test_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">X_test</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y_test</span><span class="p">)),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="eda">
<h2><strong>EDA</strong><a class="headerlink" href="#eda" title="Link to this heading">#</a></h2>
<p>In this section we are going to complement this predictive modeling project with  an exploratory data analysis.</p>
<p>We are going to carry out an exploratory data analysis (EDA) only on training data because of the above.</p>
<section id="descriptive-summary">
<h3><strong>Descriptive summary</strong><a class="headerlink" href="#descriptive-summary" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;n_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;n_bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;n_floors&#39;</span><span class="p">,</span> <span class="s1">&#39;sq_mt_allotment&#39;</span><span class="p">,</span> <span class="s1">&#39;buy_price&#39;</span><span class="p">]</span>
<span class="n">cat_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">madrid_houses_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">quant_columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_summary</span><span class="p">,</span> <span class="n">cat_summary</span> <span class="o">=</span> <span class="n">summary</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">auto_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">quant_col_names</span><span class="o">=</span><span class="n">quant_columns</span><span class="p">,</span>
                                     <span class="n">cat_col_names</span><span class="o">=</span><span class="n">cat_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sq_mt_built</th>
      <th>n_rooms</th>
      <th>n_bathrooms</th>
      <th>n_floors</th>
      <th>sq_mt_allotment</th>
      <th>buy_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n_unique</th>
      <td>689</td>
      <td>17</td>
      <td>15</td>
      <td>6</td>
      <td>304</td>
      <td>2034</td>
    </tr>
    <tr>
      <th>prop_nan</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>154.019155</td>
      <td>3.012683</td>
      <td>2.098311</td>
      <td>1.235263</td>
      <td>59.190708</td>
      <td>651756.495038</td>
    </tr>
    <tr>
      <th>std</th>
      <td>164.515279</td>
      <td>1.509707</td>
      <td>1.407854</td>
      <td>0.710341</td>
      <td>398.791114</td>
      <td>776142.000602</td>
    </tr>
    <tr>
      <th>min</th>
      <td>13.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>39000.0</td>
    </tr>
    <tr>
      <th>Q10</th>
      <td>55.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>135500.0</td>
    </tr>
    <tr>
      <th>Q25</th>
      <td>70.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>199000.0</td>
    </tr>
    <tr>
      <th>median</th>
      <td>100.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>375000.0</td>
    </tr>
    <tr>
      <th>Q75</th>
      <td>165.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>755000.0</td>
    </tr>
    <tr>
      <th>Q90</th>
      <td>314.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1550000.0</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2400.0</td>
      <td>24.0</td>
      <td>16.0</td>
      <td>7.0</td>
      <td>21000.0</td>
      <td>8800000.0</td>
    </tr>
    <tr>
      <th>kurtosis</th>
      <td>35.977168</td>
      <td>11.227589</td>
      <td>8.851221</td>
      <td>11.921627</td>
      <td>681.703793</td>
      <td>19.434455</td>
    </tr>
    <tr>
      <th>skew</th>
      <td>4.454875</td>
      <td>1.390361</td>
      <td>2.028374</td>
      <td>3.140461</td>
      <td>19.343328</td>
      <td>3.29838</td>
    </tr>
    <tr>
      <th>n_outliers</th>
      <td>1574</td>
      <td>151</td>
      <td>1964</td>
      <td>1811</td>
      <td>1003</td>
      <td>1487</td>
    </tr>
    <tr>
      <th>n_not_outliers</th>
      <td>13643</td>
      <td>15066</td>
      <td>13253</td>
      <td>13406</td>
      <td>14214</td>
      <td>13730</td>
    </tr>
    <tr>
      <th>prop_outliers</th>
      <td>0.103437</td>
      <td>0.009923</td>
      <td>0.129066</td>
      <td>0.119012</td>
      <td>0.065913</td>
      <td>0.09772</td>
    </tr>
    <tr>
      <th>prop_not_outliers</th>
      <td>0.896563</td>
      <td>0.990077</td>
      <td>0.870934</td>
      <td>0.880988</td>
      <td>0.934087</td>
      <td>0.90228</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>floor</th>
      <th>is_renewal_needed</th>
      <th>has_lift</th>
      <th>is_exterior</th>
      <th>energy_certificate</th>
      <th>has_parking</th>
      <th>house_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>n_unique</th>
      <td>15</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>8</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>prop_nan</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>mode</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="outliers">
<h3><strong>Outliers</strong><a class="headerlink" href="#outliers" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outliers_table</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">auto</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="n">quant_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 7)</small><table border="1" class="dataframe"><thead><tr><th>quant_variables</th><th>lower_bound</th><th>upper_bound</th><th>n_outliers</th><th>n_not_outliers</th><th>prop_outliers</th><th>prop_not_outliers</th></tr><tr><td>str</td><td>f64</td><td>f64</td><td>i64</td><td>i64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>&quot;sq_mt_built&quot;</td><td>-72.5</td><td>307.5</td><td>1574</td><td>13643</td><td>0.103437</td><td>0.896563</td></tr><tr><td>&quot;n_rooms&quot;</td><td>-1.0</td><td>7.0</td><td>151</td><td>15066</td><td>0.009923</td><td>0.990077</td></tr><tr><td>&quot;n_bathrooms&quot;</td><td>-0.5</td><td>3.5</td><td>1964</td><td>13253</td><td>0.129066</td><td>0.870934</td></tr><tr><td>&quot;n_floors&quot;</td><td>1.0</td><td>1.0</td><td>1811</td><td>13406</td><td>0.119012</td><td>0.880988</td></tr><tr><td>&quot;sq_mt_allotmen…</td><td>0.0</td><td>0.0</td><td>1003</td><td>14214</td><td>0.065913</td><td>0.934087</td></tr><tr><td>&quot;buy_price&quot;</td><td>-635000.0</td><td>1.589e6</td><td>1487</td><td>13730</td><td>0.09772</td><td>0.90228</td></tr></tbody></table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_Y_train_df_trimmed</span> <span class="o">=</span> <span class="n">X_Y_train_df</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">quant_columns</span><span class="p">:</span>
    <span class="n">X_Y_train_df_trimmed</span> <span class="o">=</span> <span class="n">outlier_filter</span><span class="p">(</span><span class="n">X_Y_train_df_trimmed</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="response-analysis">
<h3><strong>Response analysis</strong><a class="headerlink" href="#response-analysis" title="Link to this heading">#</a></h3>
<section id="histogram">
<h4><strong>Histogram</strong><a class="headerlink" href="#histogram" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">x_rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dd58b71ec469d587de298c1dcd56d46e07f4f046acf76b7f2b883f4509efa7b8.png" src="_images/dd58b71ec469d587de298c1dcd56d46e07f4f046acf76b7f2b883f4509efa7b8.png" />
</div>
</div>
</section>
<section id="frequencies">
<h4><strong>Frequencies</strong><a class="headerlink" href="#frequencies" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_cat</span> <span class="o">=</span> <span class="n">quant_to_cat</span><span class="p">(</span><span class="n">X_Y_train_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="s1">&#39;quartiles&#39;</span><span class="p">,</span> <span class="n">n_intervals</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">freq_table</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">response_cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small><table border="1" class="dataframe"><thead><tr><th>buy_price: unique values</th><th>abs_freq</th><th>rel_freq</th><th>cum_abs_freq</th><th>cum_rel_freq</th></tr><tr><td>object</td><td>i64</td><td>f64</td><td>i64</td><td>f64</td></tr></thead><tbody><tr><td>(-inf, 39000]</td><td>1</td><td>0.0001</td><td>1</td><td>0.000066</td></tr><tr><td>(39000, 199000]</td><td>3829</td><td>0.2516</td><td>3830</td><td>0.251692</td></tr><tr><td>(199000, 375000]</td><td>3827</td><td>0.2515</td><td>7657</td><td>0.503187</td></tr><tr><td>(375000, 755000]</td><td>3756</td><td>0.2468</td><td>11413</td><td>0.750016</td></tr><tr><td>(755000, 8800000]</td><td>3804</td><td>0.25</td><td>15217</td><td>1.0</td></tr></tbody></table></div></div></div>
</div>
</section>
<section id="boxplot">
<h4><strong>Boxplot</strong><a class="headerlink" href="#boxplot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">x_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">statistics</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/04b258ef3f6968a9926f653ad68c7c25bc6344f95a1117f32fbafb463c74971f.png" src="_images/04b258ef3f6968a9926f653ad68c7c25bc6344f95a1117f32fbafb463c74971f.png" />
</div>
</div>
</section>
<section id="ecdf-plot">
<h4><strong>ECDF-plot</strong><a class="headerlink" href="#ecdf-plot" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecdfplot</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9d5a716de3df3c9e808de9d0ff72a49afa434bcb2cfea37bb7fbfb5866103126.png" src="_images/9d5a716de3df3c9e808de9d0ff72a49afa434bcb2cfea37bb7fbfb5866103126.png" />
</div>
</div>
</section>
</section>
<section id="relation-between-response-and-predictors">
<h3><strong>Relation between response and predictors</strong><a class="headerlink" href="#relation-between-response-and-predictors" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quant_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">quant_columns</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">response</span><span class="p">]</span>
<span class="n">cat_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_columns</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">response</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix_response</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">predictors</span><span class="o">=</span><span class="n">quant_predictors</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix_response</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0bc541e1b88a6132ac73680ad4c600328d7ab30e72821ca7cc3661fc11053f23.png" src="_images/0bc541e1b88a6132ac73680ad4c600328d7ab30e72821ca7cc3661fc11053f23.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Buy price vs Quantitative predictors&#39;</span><span class="p">,</span> 
               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">quant_predictors</span><span class="p">,</span>
               <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/974952cbf2ba43acfe42d874a422cbf463aecabf6ac99e200ea4d757da26970e.png" src="_images/974952cbf2ba43acfe42d874a422cbf463aecabf6ac99e200ea4d757da26970e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxplot_2D_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Buy prices vs Categorical predictors&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">statistics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">lines_width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.53</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span> 
                 <span class="n">legend_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color_stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e4dfdce0083c3e4325fc01f1fb6eab4f2f31b690b66c907d0afbab38664d0a0f.png" src="_images/e4dfdce0083c3e4325fc01f1fb6eab4f2f31b690b66c907d0afbab38664d0a0f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxplot_2D_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;Buy prices vs Categorical predictors&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c11483b0cb4d7f671a91e30620525fe84f3532ab8f36e5cd0a53f1a5de787296.png" src="_images/c11483b0cb4d7f671a91e30620525fe84f3532ab8f36e5cd0a53f1a5de787296.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stripplot_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span> <span class="n">jitter</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">statistics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> <span class="n">lines_width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> 
                 <span class="n">legend_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">color_stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/901631897f089310b418f17d29e3f42f31efdda500c15655e55701a9b1e31c5a.png" src="_images/901631897f089310b418f17d29e3f42f31efdda500c15655e55701a9b1e31c5a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_2D_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_xticks</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">legend_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">transparency</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4ff5b55847da7aa2dcc309c43989e7ebc2250122136c5e58e3f819f2dff8702a.png" src="_images/4ff5b55847da7aa2dcc309c43989e7ebc2250122136c5e58e3f819f2dff8702a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ecdf_2D_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">n_cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tittle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> 
                 <span class="n">response</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span> <span class="n">predictors</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span>
                 <span class="n">n_xticks</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_yticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title_height</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">legend_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">transparency</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f39e93e650bc32aea1f0d50d704989ece2dd35ce074149693d0ea18a1a9293dc.png" src="_images/f39e93e650bc32aea1f0d50d704989ece2dd35ce074149693d0ea18a1a9293dc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cat_predictors</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">cross_quant_cat_summary</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">quant_col</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">cat_col</span><span class="o">=</span><span class="n">col</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 14)</small><table border="1" class="dataframe"><thead><tr><th>floor</th><th>mean_buy_price</th><th>std_buy_price</th><th>min_buy_price</th><th>Q10_buy_price</th><th>Q25_buy_price</th><th>median_buy_price</th><th>Q75_buy_price</th><th>Q90_buy_price</th><th>max_price</th><th>kurtosis_buy_price</th><th>skew_buy_price</th><th>prop_outliers_buy_price</th><th>prop_nan_buy_price</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>-5.0</td><td>1.7851e6</td><td>1.2945e6</td><td>39000.0</td><td>475200.0</td><td>890000.0</td><td>1.49e6</td><td>2.3e6</td><td>3.495e6</td><td>8.7e6</td><td>4.512</td><td>1.745</td><td>0.091837</td><td>0.0</td></tr><tr><td>-3.0</td><td>237733.333</td><td>102940.106</td><td>115000.0</td><td>160000.0</td><td>175000.0</td><td>200000.0</td><td>250000.0</td><td>385000.0</td><td>494900.0</td><td>1.078</td><td>1.423</td><td>0.155172</td><td>0.0</td></tr><tr><td>-2.0</td><td>224156.014</td><td>154217.86</td><td>74000.0</td><td>93900.0</td><td>130000.0</td><td>175000.0</td><td>259000.0</td><td>415000.0</td><td>950000.0</td><td>7.028</td><td>2.398</td><td>0.067879</td><td>0.0</td></tr><tr><td>-1.0</td><td>323802.642</td><td>343219.37</td><td>42000.0</td><td>109000.0</td><td>140000.0</td><td>210000.0</td><td>359000.0</td><td>630000.0</td><td>3.2e6</td><td>16.575</td><td>3.51</td><td>0.105939</td><td>0.0</td></tr><tr><td>0.0</td><td>386954.342</td><td>415719.735</td><td>80000.0</td><td>124000.0</td><td>155000.0</td><td>230000.0</td><td>440000.0</td><td>790000.0</td><td>2.2e6</td><td>6.573</td><td>2.577</td><td>0.094352</td><td>0.0</td></tr><tr><td>1.0</td><td>515647.077</td><td>513707.292</td><td>61000.0</td><td>140000.0</td><td>199900.0</td><td>360000.0</td><td>630000.0</td><td>999000.0</td><td>8e6</td><td>29.949</td><td>3.92</td><td>0.083282</td><td>0.0</td></tr><tr><td>2.0</td><td>533162.318</td><td>610772.407</td><td>70000.0</td><td>130000.0</td><td>180000.0</td><td>315000.0</td><td>625000.0</td><td>1.2e6</td><td>5e6</td><td>14.534</td><td>3.273</td><td>0.100877</td><td>0.0</td></tr><tr><td>3.0</td><td>534463.084</td><td>606692.743</td><td>70000.0</td><td>130000.0</td><td>178000.0</td><td>315000.0</td><td>600000.0</td><td>1.2e6</td><td>5.5e6</td><td>10.309</td><td>2.878</td><td>0.148148</td><td>0.0</td></tr><tr><td>4.0</td><td>611404.858</td><td>714715.602</td><td>55000.0</td><td>130000.0</td><td>188400.0</td><td>365000.0</td><td>720000.0</td><td>1.375e6</td><td>6.5e6</td><td>11.715</td><td>3.009</td><td>0.091986</td><td>0.0</td></tr><tr><td>5.0</td><td>669036.809</td><td>630926.299</td><td>49500.0</td><td>175000.0</td><td>270000.0</td><td>450000.0</td><td>805000.0</td><td>1.46e6</td><td>4.5e6</td><td>6.863</td><td>2.344</td><td>0.097368</td><td>0.0</td></tr><tr><td>6.0</td><td>769124.274</td><td>809872.066</td><td>66000.0</td><td>234000.0</td><td>319000.0</td><td>550000.0</td><td>850000.0</td><td>1.74e6</td><td>8.8e6</td><td>27.77</td><td>4.123</td><td>0.046818</td><td>0.0</td></tr><tr><td>7.0</td><td>652867.224</td><td>572276.153</td><td>91000.0</td><td>215000.0</td><td>288000.0</td><td>482500.0</td><td>759000.0</td><td>1.425e6</td><td>4.1e6</td><td>8.176</td><td>2.485</td><td>0.09607</td><td>0.0</td></tr><tr><td>8.0</td><td>695522.421</td><td>552615.08</td><td>120000.0</td><td>211000.0</td><td>320000.0</td><td>540000.0</td><td>795000.0</td><td>1.5e6</td><td>2.8e6</td><td>3.154</td><td>1.828</td><td>0.007353</td><td>0.0</td></tr><tr><td>9.0</td><td>703932.059</td><td>528026.495</td><td>121000.0</td><td>203000.0</td><td>330000.0</td><td>536920.0</td><td>1.079e6</td><td>1.48e6</td><td>3.3e6</td><td>3.346</td><td>1.527</td><td>0.068493</td><td>0.0</td></tr><tr><td>10.0</td><td>935160.879</td><td>1.1675e6</td><td>174750.0</td><td>254760.0</td><td>321074.0</td><td>488250.0</td><td>939000.0</td><td>2.2797e6</td><td>7.525e6</td><td>15.856</td><td>3.534</td><td>0.082974</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>is_renewal_needed</th><th>mean_buy_price</th><th>std_buy_price</th><th>min_buy_price</th><th>Q10_buy_price</th><th>Q25_buy_price</th><th>median_buy_price</th><th>Q75_buy_price</th><th>Q90_buy_price</th><th>max_price</th><th>kurtosis_buy_price</th><th>skew_buy_price</th><th>prop_outliers_buy_price</th><th>prop_nan_buy_price</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>635567.578</td><td>759885.127</td><td>49000.0</td><td>139000.0</td><td>200000.0</td><td>365000.0</td><td>735000.0</td><td>1.495e6</td><td>8.8e6</td><td>17.864</td><td>3.422</td><td>0.095637</td><td>0.0</td></tr><tr><td>1.0</td><td>723705.952</td><td>840998.958</td><td>39000.0</td><td>126900.0</td><td>187000.0</td><td>430000.0</td><td>875000.0</td><td>1.75e6</td><td>8e6</td><td>11.796</td><td>2.851</td><td>0.087657</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>has_lift</th><th>mean_buy_price</th><th>std_buy_price</th><th>min_buy_price</th><th>Q10_buy_price</th><th>Q25_buy_price</th><th>median_buy_price</th><th>Q75_buy_price</th><th>Q90_buy_price</th><th>max_price</th><th>kurtosis_buy_price</th><th>skew_buy_price</th><th>prop_outliers_buy_price</th><th>prop_nan_buy_price</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>658804.012</td><td>1.0056e6</td><td>39000.0</td><td>109990.0</td><td>135000.0</td><td>198000.0</td><td>750000.0</td><td>1.85e6</td><td>8.7e6</td><td>11.736</td><td>2.986</td><td>0.123038</td><td>0.0</td></tr><tr><td>1.0</td><td>648529.815</td><td>644379.972</td><td>49000.0</td><td>180000.0</td><td>265000.0</td><td>445000.0</td><td>758000.0</td><td>1.4e6</td><td>8.8e6</td><td>16.46</td><td>3.186</td><td>0.088427</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>is_exterior</th><th>mean_buy_price</th><th>std_buy_price</th><th>min_buy_price</th><th>Q10_buy_price</th><th>Q25_buy_price</th><th>median_buy_price</th><th>Q75_buy_price</th><th>Q90_buy_price</th><th>max_price</th><th>kurtosis_buy_price</th><th>skew_buy_price</th><th>prop_outliers_buy_price</th><th>prop_nan_buy_price</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>335710.161</td><td>242012.879</td><td>52000.0</td><td>135000.0</td><td>185000.0</td><td>275000.0</td><td>399000.0</td><td>600000.0</td><td>2.7e6</td><td>16.453</td><td>3.052</td><td>0.06371</td><td>0.0</td></tr><tr><td>1.0</td><td>679795.234</td><td>800626.236</td><td>39000.0</td><td>135988.0</td><td>200000.0</td><td>395000.0</td><td>800000.0</td><td>1.599e6</td><td>8.8e6</td><td>15.223</td><td>3.174</td><td>0.08793</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (8, 14)</small><table border="1" class="dataframe"><thead><tr><th>energy_certificate</th><th>mean_buy_price</th><th>std_buy_price</th><th>min_buy_price</th><th>Q10_buy_price</th><th>Q25_buy_price</th><th>median_buy_price</th><th>Q75_buy_price</th><th>Q90_buy_price</th><th>max_price</th><th>kurtosis_buy_price</th><th>skew_buy_price</th><th>prop_outliers_buy_price</th><th>prop_nan_buy_price</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>642185.792</td><td>753992.242</td><td>39000.0</td><td>137500.0</td><td>199000.0</td><td>369000.0</td><td>750000.0</td><td>1.5e6</td><td>8.7e6</td><td>15.746</td><td>3.209</td><td>0.102439</td><td>0.0</td></tr><tr><td>1.0</td><td>346668.228</td><td>428497.12</td><td>53000.0</td><td>113400.0</td><td>135000.0</td><td>190000.0</td><td>370000.0</td><td>740000.0</td><td>3.595e6</td><td>18.518</td><td>3.869</td><td>0.087467</td><td>0.0</td></tr><tr><td>2.0</td><td>475198.415</td><td>662838.173</td><td>66000.0</td><td>112000.0</td><td>148000.0</td><td>259000.0</td><td>515000.0</td><td>910000.0</td><td>5e6</td><td>17.032</td><td>3.785</td><td>0.109049</td><td>0.0</td></tr><tr><td>3.0</td><td>622401.725</td><td>710730.549</td><td>57000.0</td><td>139000.0</td><td>209000.0</td><td>385000.0</td><td>720000.0</td><td>1.45e6</td><td>8e6</td><td>17.811</td><td>3.419</td><td>0.096362</td><td>0.0</td></tr><tr><td>4.0</td><td>805999.855</td><td>881449.77</td><td>80000.0</td><td>169000.0</td><td>266000.0</td><td>495000.0</td><td>950000.0</td><td>1.85e6</td><td>7.8e6</td><td>11.196</td><td>2.823</td><td>0.093899</td><td>0.0</td></tr><tr><td>5.0</td><td>908499.322</td><td>1079620.2</td><td>70000.0</td><td>184000.0</td><td>290000.0</td><td>590000.0</td><td>1.079e6</td><td>1.8e6</td><td>8.8e6</td><td>19.892</td><td>3.787</td><td>0.07855</td><td>0.0</td></tr><tr><td>6.0</td><td>805822.84</td><td>815363.793</td><td>70000.0</td><td>185000.0</td><td>268000.0</td><td>482000.0</td><td>998000.0</td><td>1.85e6</td><td>4.5e6</td><td>4.193</td><td>2.007</td><td>0.081319</td><td>0.0</td></tr><tr><td>7.0</td><td>1.0018e6</td><td>1.1524e6</td><td>80000.0</td><td>175000.0</td><td>315000.0</td><td>570620.0</td><td>1.15e6</td><td>2.5e6</td><td>7.525e6</td><td>7.264</td><td>2.501</td><td>0.060302</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 14)</small><table border="1" class="dataframe"><thead><tr><th>has_parking</th><th>mean_buy_price</th><th>std_buy_price</th><th>min_buy_price</th><th>Q10_buy_price</th><th>Q25_buy_price</th><th>median_buy_price</th><th>Q75_buy_price</th><th>Q90_buy_price</th><th>max_price</th><th>kurtosis_buy_price</th><th>skew_buy_price</th><th>prop_outliers_buy_price</th><th>prop_nan_buy_price</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>461199.273</td><td>555863.208</td><td>39000.0</td><td>125000.0</td><td>161000.0</td><td>275000.0</td><td>540000.0</td><td>945000.0</td><td>8e6</td><td>26.332</td><td>4.16</td><td>0.076561</td><td>0.0</td></tr><tr><td>1.0</td><td>993549.052</td><td>973058.005</td><td>61000.0</td><td>235000.0</td><td>350000.0</td><td>650000.0</td><td>1.3e6</td><td>2.2e6</td><td>8.8e6</td><td>9.997</td><td>2.546</td><td>0.060584</td><td>0.0</td></tr></tbody></table></div></div><div class="output text_html"><div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 14)</small><table border="1" class="dataframe"><thead><tr><th>house_type</th><th>mean_buy_price</th><th>std_buy_price</th><th>min_buy_price</th><th>Q10_buy_price</th><th>Q25_buy_price</th><th>median_buy_price</th><th>Q75_buy_price</th><th>Q90_buy_price</th><th>max_price</th><th>kurtosis_buy_price</th><th>skew_buy_price</th><th>prop_outliers_buy_price</th><th>prop_nan_buy_price</th></tr><tr><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td><td>f64</td></tr></thead><tbody><tr><td>0.0</td><td>518594.384</td><td>569854.249</td><td>42000.0</td><td>130000.0</td><td>185000.0</td><td>330000.0</td><td>605000.0</td><td>1.06e6</td><td>6.5e6</td><td>15.006</td><td>3.269</td><td>0.08299</td><td>0.0</td></tr><tr><td>1.0</td><td>1.7851e6</td><td>1.2945e6</td><td>39000.0</td><td>475200.0</td><td>890000.0</td><td>1.49e6</td><td>2.3e6</td><td>3.495e6</td><td>8.7e6</td><td>4.512</td><td>1.745</td><td>0.052045</td><td>0.0</td></tr><tr><td>2.0</td><td>210529.651</td><td>143737.952</td><td>52990.0</td><td>99900.0</td><td>135000.0</td><td>185000.0</td><td>246500.0</td><td>330000.0</td><td>1.6e6</td><td>35.615</td><td>4.682</td><td>0.052851</td><td>0.0</td></tr><tr><td>3.0</td><td>810144.684</td><td>780032.508</td><td>92260.0</td><td>169000.0</td><td>270000.0</td><td>495000.0</td><td>1.175e6</td><td>1.75e6</td><td>5e6</td><td>5.527</td><td>2.054</td><td>0.046818</td><td>0.0</td></tr><tr><td>4.0</td><td>846746.026</td><td>826488.552</td><td>120000.0</td><td>247000.0</td><td>359000.0</td><td>598000.0</td><td>1.095e6</td><td>1.69e6</td><td>8.8e6</td><td>32.417</td><td>4.422</td><td>0.045175</td><td>0.0</td></tr></tbody></table></div></div></div>
</div>
</section>
</section>
<section id="linear-regression-model">
<h2><strong>Linear Regression Model</strong><a class="headerlink" href="#linear-regression-model" title="Link to this heading">#</a></h2>
<section id="why-linear-regression">
<h3><strong>Why Linear regression?</strong><a class="headerlink" href="#why-linear-regression" title="Link to this heading">#</a></h3>
<p>The main usefulness of the linear regression model is to predict the
values of a <strong>quantitative</strong> variable, called <strong>response variable</strong>,  depending on the values of other, <strong>quantitative</strong> or <strong>categorical</strong> variables ,
called <strong>predictors</strong>.</p>
<p>The other important usefulness of this model is to make inference, in other words, analyze the relation between the response variable and the predictors.</p>
</section>
<section id="assumptions">
<h3><strong>Assumptions</strong><a class="headerlink" href="#assumptions" title="Link to this heading">#</a></h3>
<p>We have a response variable <span class="math notranslate nohighlight">\(\mathcal{Y}\)</span> and <span class="math notranslate nohighlight">\(p\)</span> predictors <span class="math notranslate nohighlight">\(\mathcal{X} = (\mathcal{X}_1,\dots, \mathcal{X}_p).\)</span></p>
<p>We also have an <span class="math notranslate nohighlight">\(n\)</span> size sample of this variables: <span class="math notranslate nohighlight">\(\hspace{0.1cm} Y\in \mathbb{R}^n, \hspace{0.2cm} X=(X_1,\dots , X_p)\in \mathbb{R}^{n\times p}\)</span></p>
<ul>
<li><p>The model is defined as follows:</p>
<div class="math notranslate nohighlight">
\[y_i \hspace{0.1cm} =  \hspace{0.1cm} \beta_0 + x_i^\prime \cdot \beta \hspace{0.05cm}+\hspace{0.05cm}  \varepsilon_i \hspace{0.1cm} =  \hspace{0.1cm}  \beta_0 + \beta_1 \cdot x_{i1} + \dots + \beta_p \cdot x_{ip} + \varepsilon_i\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_i = (x_{i1},\dots, x_{ip})^\prime \in \mathbb{R}^p\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\beta = (\beta_1, \dots, \beta_p)^\prime  \in \mathbb{R}^p\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\varepsilon_i\)</span> is the residual term.</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>The residual term has to fulfill the following properties:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(E[\varepsilon_i]=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(Var(\varepsilon_i)\hspace{0.05cm} =  \hspace{0.05cm}\sigma^2\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\varepsilon_i \sim N(0,\sigma)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(cov(\varepsilon_i , \varepsilon_j)\hspace{0.05cm} = \hspace{0.05cm}0  \hspace{0.1cm} ,  \hspace{0.1cm} \forall i\neq j\)</span></p></li>
</ul>
</li>
</ul>
<ul>
<li><p>Additional assumptions:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n  \hspace{0.1cm}&gt; \hspace{0.1cm} p+1\hspace{0.3cm}\)</span>  <span class="math notranslate nohighlight">\((\text{nº observations} \hspace{0.05cm}&gt; \hspace{0.05cm} \text{nº of beta coefficients})\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(Rg(X) \hspace{0.05cm}= \hspace{0.05cm}p+1\)</span></p></li>
</ul>
<p>These additional assumptions are important because of the <em>dimensionality problem</em>.</p>
</li>
</ul>
</section>
<section id="assumptions-consequences">
<h3><strong>Assumptions consequences</strong><a class="headerlink" href="#assumptions-consequences" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y_i\)</span> is a random variable because  <span class="math notranslate nohighlight">\(\varepsilon_i\)</span> is a random variable</p></li>
<li><p><span class="math notranslate nohighlight">\(E[y_i] \hspace{0.05cm} = \hspace{0.05cm} \textbf{x}_i^T \cdot \boldsymbol{\beta}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(Var(y_i) \hspace{0.05cm} = \hspace{0.05cm} \sigma^2\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(y_i \sim N(\hspace{0.02cm} \mathbf{x}_i^T  \cdot \beta \hspace{0.03cm} , \hspace{0.1cm} \sigma^2 \hspace{0.02cm} )\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(cov(y_i , y_j)\hspace{0.05cm} = \hspace{0.05cm}0  \hspace{0.1cm},\hspace{0.15cm} \forall i\neq j\)</span></p></li>
</ul>
</section>
<section id="matrix-representation-of-the-basic-assumption">
<h3><strong>Matrix representation of the basic assumption</strong> <a class="anchor" id="8"></a><a class="headerlink" href="#matrix-representation-of-the-basic-assumption" title="Link to this heading">#</a></h3>
<ul>
<li><p><span class="math notranslate nohighlight">\(Y \hspace{0.05cm} = \hspace{0.05cm} \beta_0 + X\cdot \beta \hspace{0.05cm} + \hspace{0.05cm}\varepsilon\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\varepsilon_i \sim N(0,\sigma^2) \hspace{0.05cm} , \hspace{0.1cm} \forall \hspace{0.1cm} i=1,...,n \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(cov(\varepsilon_i , \varepsilon_j)\hspace{0.05cm} = \hspace{0.05cm}0 \hspace{0.05cm} , \hspace{0.1cm} \forall \hspace{0.1cm} i\neq j =1,...,n \)</span></p>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\varepsilon  =(\varepsilon_{1}, \varepsilon_{2}, ..., \varepsilon_{n})^\prime\)</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="coefficient-estimation">
<h3><strong>Coefficient estimation</strong><a class="headerlink" href="#coefficient-estimation" title="Link to this heading">#</a></h3>
<p>Parameters <span class="math notranslate nohighlight">\((\beta_0, \beta)\)</span> are estimated by Maximum Likelihood or Ordinary Least Square (OLS). Both are equivalent under the previous assumptions.</p>
<div class="math notranslate nohighlight">
\[\widehat{\beta}_0, \widehat{\beta} \hspace{0.1cm} = \hspace{0.1cm} \text{arg}  \hspace{0.1cm}\underset{\beta_0, \beta}{\text{Min}} \hspace{0.1cm}  \sum_{i=1}^{n} \hspace{0.07cm}(y_i - \beta_0 + x_i^\prime \cdot \beta)^2\]</div>
<p>The solution to this problem is:</p>
<div class="math notranslate nohighlight">
\[\left(\widehat{\beta}_0, \widehat{\beta}^\prime\right)^\prime  \hspace{0.1cm} = \hspace{0.1cm} (X^\prime \cdot X)^{-1} \cdot X^\prime \cdot Y\]</div>
<p><strong>Interpretation :</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\widehat{y} = \widehat{\beta}_0 + x^\prime \cdot \widehat{\beta} \hspace{0.05cm},\hspace{0.1cm} x\in \mathbb{R}^p\hspace{0.05cm}\)</span> is the hyperplane that <strong>minimize</strong> the <strong>euclidean distance</strong> between the values of the response variable <span class="math notranslate nohighlight">\((y_i)\)</span> and the projections of these values onto that hyperplane  <span class="math notranslate nohighlight">\(\hspace{0.04cm}\widehat{y}_i = \widehat{\beta}_0 + x_i^\prime \cdot \widehat{\beta} \hspace{0.04cm} .\)</span></p></li>
</ul>
<p><img alt="image.png" src="_images/p1.png" /></p>
<p>We can estimate a Linear regression model in <code class="docutils literal notranslate"><span class="pre">Python</span></code> using <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>, a fantastic library to implement statistical models.</p>
<p>The following code is a class to perform linear regression using <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> implementation but  with the possibility of including categorical predictors as dummy variables and interactions between the predictors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">linear_model</span> <span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    

        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>

    <span class="k">def</span> <span class="nf">dummies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">):</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">transform_to_dummies</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">cols_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="n">pred_to_dummies</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">):</span>

        <span class="n">X_inter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">interactions_to_add</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="c1"># X without any changes</span>
            <span class="n">interactions_to_add</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
                                   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> 
                                   <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">X_initial</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">unique</span><span class="p">())[</span><span class="mi">1</span><span class="p">:]]</span>

        <span class="k">for</span> <span class="n">quant</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">interactions_to_add</span><span class="p">:</span>
            <span class="n">X_inter</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">quant</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">cat</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">quant</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">X_inter</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interactions_to_add</span> <span class="o">=</span> <span class="n">interactions_to_add</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="n">pred_to_dummies</span>

        <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dummies</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interactions_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_modified</span> <span class="o">=</span> <span class="n">X</span>

        <span class="n">poisson</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_fit</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred_to_dummies</span>
        <span class="n">interactions_to_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions_to_add</span>

        <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dummies</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interactions_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
        
        <span class="n">Y_hat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Y_hat</span>
</pre></div>
</div>
</div>
</div>
<p>Just to see how to use the class and their summary output we are going to train four full linear models. Full in the sense that hey will include all the available predictors, but we will distinguish four cases:</p>
<ol class="arabic simple">
<li><p>Full model with dummies for categorical predictors and some interactions</p></li>
<li><p>Full model without dummies but with interactions.</p></li>
<li><p>Full model with dummies but without interactions.</p></li>
<li><p>Full model without dummies and interactions.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statmodels only reads Pandas dataframes, for now.</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">Y_train</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions - dummies</span>
<span class="n">full_model_inter_dummies</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;n_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_lift&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_parking&#39;</span><span class="p">)]</span>
<span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions</span><span class="p">)</span>
<span class="n">results_full_model_inter_dummies</span> <span class="o">=</span> <span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions </span>
<span class="n">full_model_inter</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;n_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_lift&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_parking&#39;</span><span class="p">)]</span>
<span class="n">full_model_inter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions</span><span class="p">)</span>
<span class="n">results_full_model_inter</span> <span class="o">=</span> <span class="n">full_model_inter</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - dummies</span>
<span class="n">full_model_dummies</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">full_model_dummies</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">results_full_model_dummies</span> <span class="o">=</span> <span class="n">full_model_dummies</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - basic - not interactions - not dummies</span>
<span class="n">full_model_basic</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">full_model_basic</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">results_full_model_basic</span> <span class="o">=</span> <span class="n">full_model_basic</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We are going to print the summaries of the respective models just to see how they look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_full_model_inter_dummies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:              buy_price   R-squared (uncentered):                   0.858
Model:                            OLS   Adj. R-squared (uncentered):              0.858
Method:                 Least Squares   F-statistic:                              2478.
Date:                Fri, 29 Dec 2023   Prob (F-statistic):                        0.00
Time:                        10:07:47   Log-Likelihood:                     -2.1718e+05
No. Observations:               15217   AIC:                                  4.344e+05
Df Residuals:                   15180   BIC:                                  4.347e+05
Df Model:                          37                                                  
Covariance Type:            nonrobust                                                  
=============================================================================================
                                coef    std err          t      P&gt;|t|      [0.025      0.975]
---------------------------------------------------------------------------------------------
sq_mt_built                1532.8474    342.962      4.469      0.000     860.601    2205.094
n_rooms                   -2.334e+04   1.27e+04     -1.834      0.067   -4.83e+04    1604.965
n_bathrooms                1.161e+05   4883.095     23.768      0.000    1.06e+05    1.26e+05
n_floors                   2954.8637   1.15e+04      0.257      0.797   -1.96e+04    2.55e+04
sq_mt_allotment              17.1423     11.454      1.497      0.135      -5.309      39.594
floor_-2                    2.16e+04   4.57e+04      0.473      0.636   -6.79e+04    1.11e+05
floor_-3                   2.852e+04   7.43e+04      0.384      0.701   -1.17e+05    1.74e+05
floor_-5                   1.798e+05    1.6e+04     11.269      0.000    1.49e+05    2.11e+05
floor_0                   -2.145e+04    2.9e+04     -0.741      0.459   -7.82e+04    3.53e+04
floor_1                    4.552e+04   1.19e+04      3.838      0.000    2.23e+04    6.88e+04
floor_10                   1.921e+05   5.37e+04      3.580      0.000    8.69e+04    2.97e+05
floor_2                    6.145e+04    1.2e+04      5.137      0.000     3.8e+04    8.49e+04
floor_3                    7.209e+04   1.28e+04      5.646      0.000    4.71e+04    9.71e+04
floor_4                    8.572e+04   1.36e+04      6.319      0.000    5.91e+04    1.12e+05
floor_5                    7.016e+04   1.61e+04      4.356      0.000    3.86e+04    1.02e+05
floor_6                    1.201e+05   1.87e+04      6.424      0.000    8.35e+04    1.57e+05
floor_7                    5.762e+04   2.24e+04      2.574      0.010    1.37e+04    1.01e+05
floor_8                    3.871e+04   2.75e+04      1.407      0.159   -1.52e+04    9.26e+04
floor_9                   -3.907e+04   3.46e+04     -1.130      0.259   -1.07e+05    2.87e+04
is_renewal_needed_1       -1446.7651   8443.816     -0.171      0.864    -1.8e+04    1.51e+04
has_lift_1                -2.001e+05   1.03e+04    -19.477      0.000    -2.2e+05    -1.8e+05
is_exterior_1             -6.444e+04   1.56e+04     -4.139      0.000    -9.5e+04   -3.39e+04
energy_certificate_1      -2.954e+04   1.61e+04     -1.840      0.066    -6.1e+04    1921.923
energy_certificate_2       1.601e+04   1.84e+04      0.871      0.384      -2e+04     5.2e+04
energy_certificate_3      -1.083e+04   9581.489     -1.130      0.258   -2.96e+04    7952.322
energy_certificate_4       2.634e+04   1.44e+04      1.833      0.067   -1820.563    5.45e+04
energy_certificate_5       8.849e+04   1.96e+04      4.511      0.000       5e+04    1.27e+05
energy_certificate_6       4.643e+04   2.15e+04      2.162      0.031    4330.549    8.85e+04
energy_certificate_7       5.894e+04    1.9e+04      3.098      0.002    2.17e+04    9.62e+04
has_parking_1             -6.756e+04   1.07e+04     -6.285      0.000   -8.86e+04   -4.65e+04
house_type_1               1.798e+05    1.6e+04     11.269      0.000    1.49e+05    2.11e+05
house_type_2                914.7454   2.48e+04      0.037      0.971   -4.77e+04    4.95e+04
house_type_3              -9.499e+04   2.15e+04     -4.427      0.000   -1.37e+05   -5.29e+04
house_type_4               2.223e+04   1.61e+04      1.382      0.167   -9307.052    5.38e+04
n_rooms:is_exterior_1     -2.243e+04    1.3e+04     -1.732      0.083   -4.78e+04    2961.653
sq_mt_built:is_exterior_1   911.2754    341.102      2.672      0.008     242.674    1579.877
sq_mt_built:has_lift_1     3242.8230     65.614     49.423      0.000    3114.211    3371.435
sq_mt_built:has_parking_1    -8.3343     47.758     -0.175      0.861    -101.947      85.278
==============================================================================
Omnibus:                    11702.338   Durbin-Watson:                   2.014
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          1216497.472
Skew:                           2.995   Prob(JB):                         0.00
Kurtosis:                      46.391   Cond. No.                     1.33e+16
==============================================================================

Notes:
[1] R² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[3] The smallest eigenvalue is  2e-23. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_full_model_inter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:              buy_price   R-squared (uncentered):                   0.855
Model:                            OLS   Adj. R-squared (uncentered):              0.855
Method:                 Least Squares   F-statistic:                              5595.
Date:                Fri, 29 Dec 2023   Prob (F-statistic):                        0.00
Time:                        10:07:47   Log-Likelihood:                     -2.1734e+05
No. Observations:               15217   AIC:                                  4.347e+05
Df Residuals:                   15201   BIC:                                  4.348e+05
Df Model:                          16                                                  
Covariance Type:            nonrobust                                                  
===========================================================================================
                              coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------------
sq_mt_built              1480.0192    341.947      4.328      0.000     809.762    2150.276
n_rooms                 -2.711e+04   1.25e+04     -2.161      0.031   -5.17e+04   -2516.047
n_bathrooms              1.239e+05   4894.994     25.311      0.000    1.14e+05    1.33e+05
n_floors                 6.808e+04   8106.271      8.398      0.000    5.22e+04     8.4e+04
sq_mt_allotment            20.4074     11.486      1.777      0.076      -2.106      42.920
floor                    1806.0012   1445.093      1.250      0.211   -1026.555    4638.558
is_renewal_needed         448.5235   8482.591      0.053      0.958   -1.62e+04    1.71e+04
has_lift                -1.997e+05   1.02e+04    -19.554      0.000    -2.2e+05    -1.8e+05
is_exterior             -1.057e+05   1.24e+04     -8.512      0.000    -1.3e+05   -8.13e+04
energy_certificate       6299.9469   1657.801      3.800      0.000    3050.459    9549.435
has_parking             -4.571e+04   1.07e+04     -4.263      0.000   -6.67e+04   -2.47e+04
house_type              -2961.0812   3440.179     -0.861      0.389   -9704.246    3782.083
n_rooms:is_exterior      -1.23e+04   1.29e+04     -0.957      0.339   -3.75e+04    1.29e+04
sq_mt_built:is_exterior  1120.7517    339.798      3.298      0.001     454.707    1786.797
sq_mt_built:has_lift     2962.2037     63.507     46.643      0.000    2837.722    3086.686
sq_mt_built:has_parking   -63.0704     48.004     -1.314      0.189    -157.163      31.023
==============================================================================
Omnibus:                    11375.312   Durbin-Watson:                   2.012
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          1245548.674
Skew:                           2.840   Prob(JB):                         0.00
Kurtosis:                      46.957   Cond. No.                     2.81e+03
==============================================================================

Notes:
[1] R² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[3] The condition number is large, 2.81e+03. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_full_model_dummies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:              buy_price   R-squared (uncentered):                   0.834
Model:                            OLS   Adj. R-squared (uncentered):              0.834
Method:                 Least Squares   F-statistic:                              2317.
Date:                Fri, 29 Dec 2023   Prob (F-statistic):                        0.00
Time:                        10:07:47   Log-Likelihood:                     -2.1835e+05
No. Observations:               15217   AIC:                                  4.368e+05
Df Residuals:                   15184   BIC:                                  4.370e+05
Df Model:                          33                                                  
Covariance Type:            nonrobust                                                  
========================================================================================
                           coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------------
sq_mt_built           3335.6205     46.524     71.697      0.000    3244.428    3426.812
n_rooms              -1.104e+04   3651.373     -3.024      0.003   -1.82e+04   -3883.486
n_bathrooms           1.745e+05   5109.825     34.159      0.000    1.65e+05    1.85e+05
n_floors             -1.873e+05   1.05e+04    -17.917      0.000   -2.08e+05   -1.67e+05
sq_mt_allotment       -203.9127     11.375    -17.927      0.000    -226.208    -181.617
floor_-2             -1.672e+04   4.92e+04     -0.340      0.734   -1.13e+05    7.97e+04
floor_-3             -2.159e+04      8e+04     -0.270      0.787   -1.78e+05    1.35e+05
floor_-5              9.356e+04   1.64e+04      5.716      0.000    6.15e+04    1.26e+05
floor_0              -4.151e+04    3.1e+04     -1.338      0.181   -1.02e+05    1.93e+04
floor_1               1.507e+04   1.24e+04      1.219      0.223   -9170.640    3.93e+04
floor_10              1.517e+05   5.78e+04      2.622      0.009    3.83e+04    2.65e+05
floor_2               3.915e+04   1.24e+04      3.145      0.002    1.48e+04    6.36e+04
floor_3               5.149e+04   1.33e+04      3.858      0.000    2.53e+04    7.77e+04
floor_4               7.532e+04   1.43e+04      5.280      0.000    4.74e+04    1.03e+05
floor_5               5.628e+04   1.71e+04      3.296      0.001    2.28e+04    8.97e+04
floor_6               1.078e+05   1.99e+04      5.414      0.000    6.87e+04    1.47e+05
floor_7               3.238e+04    2.4e+04      1.350      0.177   -1.46e+04    7.94e+04
floor_8               1.446e+04   2.96e+04      0.488      0.625   -4.36e+04    7.25e+04
floor_9              -3.121e+04   3.73e+04     -0.838      0.402   -1.04e+05    4.18e+04
is_renewal_needed_1   2.865e+04   9052.496      3.165      0.002    1.09e+04    4.64e+04
has_lift_1            8.137e+04   8818.001      9.228      0.000    6.41e+04    9.87e+04
is_exterior_1        -6.605e+04   1.11e+04     -5.964      0.000   -8.78e+04   -4.43e+04
energy_certificate_1 -4.099e+04   1.73e+04     -2.369      0.018   -7.49e+04   -7078.883
energy_certificate_2 -9636.5864   1.98e+04     -0.486      0.627   -4.85e+04    2.92e+04
energy_certificate_3  -1.93e+04   1.03e+04     -1.867      0.062   -3.95e+04     957.103
energy_certificate_4  2.805e+04   1.55e+04      1.809      0.070   -2343.800    5.85e+04
energy_certificate_5   1.01e+05   2.12e+04      4.767      0.000    5.95e+04    1.42e+05
energy_certificate_6   2.95e+04   2.32e+04      1.273      0.203   -1.59e+04    7.49e+04
energy_certificate_7   5.37e+04   2.05e+04      2.619      0.009    1.35e+04    9.39e+04
has_parking_1        -2.764e+04   8066.556     -3.427      0.001   -4.35e+04   -1.18e+04
house_type_1          9.356e+04   1.64e+04      5.716      0.000    6.15e+04    1.26e+05
house_type_2          5826.3125   2.66e+04      0.219      0.827   -4.63e+04    5.79e+04
house_type_3          1.437e+05   2.22e+04      6.465      0.000       1e+05    1.87e+05
house_type_4          7.542e+04   1.73e+04      4.351      0.000    4.14e+04    1.09e+05
==============================================================================
Omnibus:                     8988.079   Durbin-Watson:                   2.022
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          1125984.333
Skew:                           1.880   Prob(JB):                         0.00
Kurtosis:                      44.973   Cond. No.                     1.27e+16
==============================================================================

Notes:
[1] R² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[3] The smallest eigenvalue is 1.72e-23. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results_full_model_basic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:              buy_price   R-squared (uncentered):                   0.833
Model:                            OLS   Adj. R-squared (uncentered):              0.833
Method:                 Least Squares   F-statistic:                              6323.
Date:                Fri, 29 Dec 2023   Prob (F-statistic):                        0.00
Time:                        10:07:47   Log-Likelihood:                     -2.1841e+05
No. Observations:               15217   AIC:                                  4.368e+05
Df Residuals:                   15205   BIC:                                  4.369e+05
Df Model:                          12                                                  
Covariance Type:            nonrobust                                                  
======================================================================================
                         coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------------
sq_mt_built         3361.2021     46.165     72.808      0.000    3270.713    3451.691
n_rooms            -1.082e+04   3522.682     -3.073      0.002   -1.77e+04   -3919.647
n_bathrooms         1.762e+05   5103.800     34.515      0.000    1.66e+05    1.86e+05
n_floors           -1.394e+05   6846.789    -20.359      0.000   -1.53e+05   -1.26e+05
sq_mt_allotment     -195.4226     11.286    -17.316      0.000    -217.544    -173.301
floor               5199.6852   1494.271      3.480      0.001    2270.735    8128.636
is_renewal_needed   2.364e+04   9034.689      2.616      0.009    5928.776    4.13e+04
has_lift            6.459e+04   8148.929      7.926      0.000    4.86e+04    8.06e+04
is_exterior        -8.815e+04   9927.824     -8.879      0.000   -1.08e+05   -6.87e+04
energy_certificate  5251.0132   1771.320      2.964      0.003    1779.014    8723.012
has_parking        -1.978e+04   7990.224     -2.476      0.013   -3.54e+04   -4118.021
house_type          2.391e+04   3626.919      6.592      0.000    1.68e+04     3.1e+04
==============================================================================
Omnibus:                     8971.290   Durbin-Watson:                   2.020
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          1170728.967
Skew:                           1.863   Prob(JB):                         0.00
Kurtosis:                      45.809   Cond. No.                     1.42e+03
==============================================================================

Notes:
[1] R² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[3] The condition number is large, 1.42e+03. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
</div>
</div>
</section>
<section id="standard-deviation-of-coefficients">
<h3><strong>Standard deviation of coefficients</strong><a class="headerlink" href="#standard-deviation-of-coefficients" title="Link to this heading">#</a></h3>
<p>The precision of beta coefficients estimations is given by the
standard deviation of their estimators:</p>
<div class="math notranslate nohighlight">
\[s_d(\widehat{\beta}_j)=\sqrt{\sigma^2 \cdot q_{jj}}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(q_{jj}\hspace{0.05cm} = diag\left( (X^T \cdot X)^{-1} \right)[j+1]\hspace{0.05cm}\)</span>  is the <span class="math notranslate nohighlight">\(j+1\)</span> element    of the principal diagonal of the matrix <span class="math notranslate nohighlight">\((X^T \cdot X)^{-1}\)</span>  <span class="math notranslate nohighlight">\(\hspace{0.01cm} , \hspace{0.05cm}\)</span> for <span class="math notranslate nohighlight">\(\small{j=0,1,\dots,p}\)</span> .</p></li>
</ul>
<p>To estimate <span class="math notranslate nohighlight">\(sd(\widehat{\beta}_j)\)</span> we need to estimate <span class="math notranslate nohighlight">\(\sigma^2\)</span>, i.e, the variance of the error term <span class="math notranslate nohighlight">\(\varepsilon_i\)</span>.</p>
<p>We can estimate it as follows:</p>
<div class="math notranslate nohighlight">
\[\widehat{\sigma}^2 \hspace{0.1cm}=\hspace{0.1cm} \dfrac{1}{n-p-1} \cdot \sum_{i=1}^{n} \hspace{0.05cm}\hat{\varepsilon}_i^2   
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(RSS = \sum_{i=1}^{n} \hspace{0.05cm}\widehat{\varepsilon}_i^2\)</span> is the residual sum of squares.</p></li>
<li><p><span class="math notranslate nohighlight">\(\widehat{\varepsilon}_i =  y_i - \widehat{y}_i\)</span> is the estimation of the <span class="math notranslate nohighlight">\(i\)</span>-th residual term.</p></li>
</ul>
<p>Then, we have the following estimation for the standard deviation of the coefficients:</p>
<div class="math notranslate nohighlight">
\[\widehat{s_d}(\widehat{\beta}_j)=\sqrt{\widehat{\sigma}^2 \cdot q_{jj}}\]</div>
<p><strong>Why is the variance of the coefficient estimators important?</strong></p>
<p>The standard deviation of a coefficient estimator indicates how much
the estimation of that coefficient varies, in mean, when the model is  trained with many different samples.</p>
<p>Suppose many samples are obtained, and with each of them a linear
regression model is trained. Then, we get many estimations of the model
coefficient <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span>, one with each sample.</p>
<p>Then, <span class="math notranslate nohighlight">\(s_d(\widehat{\beta}_j)\)</span> indicates how much
<span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> varies from one sample to another, in mean.</p>
<p><strong>Interpretation:</strong></p>
<ul class="simple">
<li><p>If the standard deviation is <strong>high</strong>, this indicates that will be obtained
big differences when <span class="math notranslate nohighlight">\(\beta_j\)</span> is estimate with <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span>
depending on the sample that is used for estimate it, that means
estimator <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> is <strong>imprecise</strong>, because it will be much
dispersion of the values of <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> respect to the mean.</p></li>
<li><p>On the contrary, if the standard deviation is <strong>low</strong>, this indicates that
will be obtained small differences when <span class="math notranslate nohighlight">\(\beta_j\)</span> is estimate with
<span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> depending on the sample that is used for estimate it,
that means estimator <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> is <strong>precise</strong>, because it will be little
dispersion of the values of <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> respect to the mean.</p></li>
<li><p>In addition, <span class="math notranslate nohighlight">\(\widehat{s_d}(\widehat{\beta}_j)\)</span> allows to define a confidence interval for <span class="math notranslate nohighlight">\(\widehat{\beta}_j\)</span> estimator .</p></li>
</ul>
<p>We can obtain the estimation fo the standard deviation of coefficient estimators with our class as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">bse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sq_mt_built                    342.961695
n_rooms                      12727.596343
n_bathrooms                   4883.094974
n_floors                     11493.166017
sq_mt_allotment                 11.454317
floor_-2                     45685.141817
floor_-3                     74314.873388
floor_-5                     15959.232517
floor_0                      28964.054054
floor_1                      11861.824556
floor_10                     53666.317778
floor_2                      11961.359039
floor_3                      12769.649023
floor_4                      13566.003037
floor_5                      16106.923393
floor_6                      18701.565813
floor_7                      22382.217113
floor_8                      27512.954519
floor_9                      34577.619792
is_renewal_needed_1           8443.816143
has_lift_1                   10273.791241
is_exterior_1                15569.325847
energy_certificate_1         16050.032312
energy_certificate_2         18377.709130
energy_certificate_3          9581.488722
energy_certificate_4         14368.369556
energy_certificate_5         19618.537772
energy_certificate_6         21476.579454
energy_certificate_7         19023.827742
has_parking_1                10748.365169
house_type_1                 15959.232517
house_type_2                 24788.864438
house_type_3                 21458.713817
house_type_4                 16091.495675
n_rooms:is_exterior_1        12956.445872
sq_mt_built:is_exterior_1      341.102462
sq_mt_built:has_lift_1          65.614214
sq_mt_built:has_parking_1       47.758490
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="confidence-intervals-for-coefficients">
<h3><strong>Confidence intervals for  coefficients</strong><a class="headerlink" href="#confidence-intervals-for-coefficients" title="Link to this heading">#</a></h3>
<p>Confidence intervals for beta coefficients at a level <span class="math notranslate nohighlight">\(1-\alpha\)</span> can be defined as follows:</p>
<div class="math notranslate nohighlight">
\[CI(\beta_j)_{1-\alpha} = \left[\widehat{\beta}_j \hspace{0.1cm} \pm \hspace{0.1cm} t^{n-p-1}_{\alpha/2}\cdot \widehat{s_d}(\widehat{\beta}_j)\right]\]</div>
<p><strong>Observation:</strong></p>
<p>The smaller <span class="math notranslate nohighlight">\(\widehat{s_d}(\widehat{\beta}_j)\)</span>, the smaller <span class="math notranslate nohighlight">\(CI(\beta_j)\)</span>.</p>
<p>Using our class these confidence intervals can be obtained as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">betas_CI</span> <span class="o">=</span> <span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">conf_int</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">betas_CI</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2.5%&#39;</span><span class="p">,</span> <span class="s1">&#39;97.5%&#39;</span><span class="p">]</span>
<span class="n">betas_CI</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2.5%</th>
      <th>97.5%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>sq_mt_built</th>
      <td>860.601179</td>
      <td>2205.093522</td>
    </tr>
    <tr>
      <th>n_rooms</th>
      <td>-48290.274169</td>
      <td>1604.965066</td>
    </tr>
    <tr>
      <th>n_bathrooms</th>
      <td>106488.712368</td>
      <td>125631.619276</td>
    </tr>
    <tr>
      <th>n_floors</th>
      <td>-19573.123999</td>
      <td>25482.851420</td>
    </tr>
    <tr>
      <th>sq_mt_allotment</th>
      <td>-5.309497</td>
      <td>39.594179</td>
    </tr>
    <tr>
      <th>floor_-2</th>
      <td>-67947.157168</td>
      <td>111149.588124</td>
    </tr>
    <tr>
      <th>floor_-3</th>
      <td>-117142.811317</td>
      <td>174189.368494</td>
    </tr>
    <tr>
      <th>floor_-5</th>
      <td>148561.896433</td>
      <td>211125.926824</td>
    </tr>
    <tr>
      <th>floor_0</th>
      <td>-78223.279453</td>
      <td>35322.779618</td>
    </tr>
    <tr>
      <th>floor_1</th>
      <td>22269.505846</td>
      <td>68770.711419</td>
    </tr>
    <tr>
      <th>floor_10</th>
      <td>86907.704353</td>
      <td>297292.579248</td>
    </tr>
    <tr>
      <th>floor_2</th>
      <td>38001.357637</td>
      <td>84892.762324</td>
    </tr>
    <tr>
      <th>floor_3</th>
      <td>47061.751438</td>
      <td>97121.847295</td>
    </tr>
    <tr>
      <th>floor_4</th>
      <td>59132.930780</td>
      <td>112314.925930</td>
    </tr>
    <tr>
      <th>floor_5</th>
      <td>38586.221564</td>
      <td>101729.235716</td>
    </tr>
    <tr>
      <th>floor_6</th>
      <td>83479.099833</td>
      <td>156793.736404</td>
    </tr>
    <tr>
      <th>floor_7</th>
      <td>13747.950497</td>
      <td>101491.625530</td>
    </tr>
    <tr>
      <th>floor_8</th>
      <td>-15220.609435</td>
      <td>92636.790406</td>
    </tr>
    <tr>
      <th>floor_9</th>
      <td>-106845.010601</td>
      <td>28707.576483</td>
    </tr>
    <tr>
      <th>is_renewal_needed_1</th>
      <td>-17997.660287</td>
      <td>15104.130116</td>
    </tr>
    <tr>
      <th>has_lift_1</th>
      <td>-220240.977098</td>
      <td>-179965.244118</td>
    </tr>
    <tr>
      <th>is_exterior_1</th>
      <td>-94959.788264</td>
      <td>-33924.285808</td>
    </tr>
    <tr>
      <th>energy_certificate_1</th>
      <td>-60998.064103</td>
      <td>1921.923328</td>
    </tr>
    <tr>
      <th>energy_certificate_2</th>
      <td>-20011.903303</td>
      <td>52033.137167</td>
    </tr>
    <tr>
      <th>energy_certificate_3</th>
      <td>-29609.418365</td>
      <td>7952.322211</td>
    </tr>
    <tr>
      <th>energy_certificate_4</th>
      <td>-1820.562564</td>
      <td>54506.902347</td>
    </tr>
    <tr>
      <th>energy_certificate_5</th>
      <td>50037.593213</td>
      <td>126946.980438</td>
    </tr>
    <tr>
      <th>energy_certificate_6</th>
      <td>4330.549406</td>
      <td>88523.906965</td>
    </tr>
    <tr>
      <th>energy_certificate_7</th>
      <td>21652.184603</td>
      <td>96230.165451</td>
    </tr>
    <tr>
      <th>has_parking_1</th>
      <td>-88623.480438</td>
      <td>-46487.303504</td>
    </tr>
    <tr>
      <th>house_type_1</th>
      <td>148561.896433</td>
      <td>211125.926824</td>
    </tr>
    <tr>
      <th>house_type_2</th>
      <td>-47674.410344</td>
      <td>49503.901108</td>
    </tr>
    <tr>
      <th>house_type_3</th>
      <td>-137055.965536</td>
      <td>-52932.645570</td>
    </tr>
    <tr>
      <th>house_type_4</th>
      <td>-9307.052383</td>
      <td>53775.481406</td>
    </tr>
    <tr>
      <th>n_rooms:is_exterior_1</th>
      <td>-47830.731598</td>
      <td>2961.652840</td>
    </tr>
    <tr>
      <th>sq_mt_built:is_exterior_1</th>
      <td>242.673582</td>
      <td>1579.877285</td>
    </tr>
    <tr>
      <th>sq_mt_built:has_lift_1</th>
      <td>3114.211238</td>
      <td>3371.434739</td>
    </tr>
    <tr>
      <th>sq_mt_built:has_parking_1</th>
      <td>-101.946727</td>
      <td>85.278040</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="goodness-of-fit">
<h3><strong>Goodness of fit</strong><a class="headerlink" href="#goodness-of-fit" title="Link to this heading">#</a></h3>
<section id="r-square">
<h4><strong>R-square</strong><a class="headerlink" href="#r-square" title="Link to this heading">#</a></h4>
<p>The R-square is a measure of the goodness of fit of the linear regression model to the training data.</p>
<div class="math notranslate nohighlight">
\[R^2 \hspace{0.05cm}=\hspace{0.05cm} \dfrac{\hspace{0.07cm}RegSS\hspace{0.07cm}}{TSS} \hspace{0.05cm}=\hspace{0.05cm} \dfrac{\hspace{0.07cm}TSS-RSS\hspace{0.07cm}}{TSS} \hspace{0.05cm}=\hspace{0.05cm} 1 - \dfrac{RSS}{TSS}\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><strong>Total Sum Squares</strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[
TSS \hspace{0.1cm} = \hspace{0.1cm} \sum_{i=1}^n ( y_i - \overline{y})^2
\]</div>
<ul class="simple">
<li><p><strong>Residual Sum Squares</strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[
RSS=  \sum_{i=1}^n \widehat{\varepsilon}_i^2 =  \sum_{i=1}^n ( y_i - \hat{y}_i)^2
\]</div>
<ul class="simple">
<li><p><strong>Regression Sum Squares</strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[ 
RegSS =  \sum_{i=1}^n ( \hat{y}_i - \overline{y} )^2
\]</div>
<p>It can be proved that:</p>
<div class="math notranslate nohighlight">
\[
TSS=RSS+RegSS
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(TSS \hspace{0.05cm}\)</span> is the total variance of the response variable <span class="math notranslate nohighlight">\(Y\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(RegSS \hspace{0.05cm}\)</span> is the variance of the response variable <span class="math notranslate nohighlight">\(Y\)</span> <strong>explained</strong> by the
model using <span class="math notranslate nohighlight">\(X\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(RSS \hspace{0.05cm}\)</span> is the variance of the response variable <span class="math notranslate nohighlight">\(Y\)</span> <strong>not explained</strong> by the
model using <span class="math notranslate nohighlight">\(X\)</span></p></li>
</ul>
<p><strong>Properties:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(R^2\)</span> is the total variance of the response explaining by the linear regression model by mean of the predictors.</p></li>
<li><p><span class="math notranslate nohighlight">\(R^2 \in \left[ 0 , 1 \right]\)</span></p></li>
</ul>
<p>For this reason, <span class="math notranslate nohighlight">\(\hspace{0.01cm}R^2\hspace{0.01cm}\)</span> is used as a measure of how well the model fits the response variable.</p>
<p><strong>Interpretation:</strong></p>
<p>The <span class="math notranslate nohighlight">\(\hspace{0.01cm}R^2\hspace{0.01cm}\)</span> interpretation is the following:</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\hspace{0.01cm}R^2\hspace{0.01cm}\)</span> is close to <span class="math notranslate nohighlight">\(1\)</span>, this means that the model is fitting well the response data.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\hspace{0.01cm}R^2\hspace{0.01cm}\)</span> is close to <span class="math notranslate nohighlight">\(0\)</span>, this means that the model is fitting badly the response data.</p></li>
</ul>
<p>We can obtain it using our class as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">rsquared</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8579358772571637
</pre></div>
</div>
</div>
</div>
</section>
<section id="adjusted-r-square">
<h4><strong>Adjusted R-square</strong><a class="headerlink" href="#adjusted-r-square" title="Link to this heading">#</a></h4>
<p>The <span class="math notranslate nohighlight">\(R^2\)</span> has some problems:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hspace{0.1cm} R^2\)</span> always increase when increase the number of predictors,
although they are not significative.</p></li>
<li><p>It´s possible estimate two models with the same prediction power but
with different <span class="math notranslate nohighlight">\(\hspace{0.1cm}R^2\)</span></p></li>
</ul>
<p>For avoid the disadvantages of <span class="math notranslate nohighlight">\(\hspace{0.1cm}R^2\hspace{0.1cm}\)</span> was created the adjusted <span class="math notranslate nohighlight">\(\hspace{0.1cm}R^2\hspace{0.1cm}\)</span> ,
denoted as <span class="math notranslate nohighlight">\(\widehat{R^2}\)</span>, and defined as:</p>
<div class="math notranslate nohighlight">
\[
 R^2_{adj} =  1 - \dfrac{RSS/(n-p-1)}{TSS/(n-1)} = 1 - \left( 1- R^2 \right) \cdot \dfrac{n-1}{n-p}
\]</div>
<p>This metric doesn’t grow when including irrelevant predictors, because if <span class="math notranslate nohighlight">\(\hspace{0.1cm} RSS\hspace{0.1cm}\)</span> is small because of <span class="math notranslate nohighlight">\(\hspace{0.1cm}p\hspace{0.1cm}\)</span> is large, then  <span class="math notranslate nohighlight">\(\hspace{0.1cm}1/(n-p-1)\hspace{0.1cm}\)</span> will be large compensating the <span class="math notranslate nohighlight">\(\hspace{0.01cm}RSS\hspace{0.01cm}\)</span> value</p>
<p>We can obtain it using our class as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">rsquared_adj</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8575896076562753
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="global-significance-test-anova">
<h3><strong>Global Significance Test (ANOVA)</strong><a class="headerlink" href="#global-significance-test-anova" title="Link to this heading">#</a></h3>
<p>The <strong>test of model global significance</strong> is also called <strong>ANOVA</strong> test, and is defined by the following hypothesis :</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\hspace{-0.7 cm} H_0: \hspace{0.1cm} \beta_1=\dots =\beta_p=0 \\
H_1: \hspace{0.1cm} \beta_j \neq 0 \hspace{0.05cm},\hspace{0.15cm} \exists \ j=1,\dots ,p 
\end{split}\]</div>
<p><strong>Statistic:</strong></p>
<p>The <strong>test statistic</strong> for the ANOVA test is the following:</p>
<div class="math notranslate nohighlight">
\[
F_{exp|H_0}= \dfrac{(TSS-RSS)/p}{RSS/(n-p-1)} = \dfrac{RegSS/p}{RSS/(n-p-1)} \hspace{0.05cm} \sim \hspace{0.05cm}  F_{\hspace{0.05cm}p,\hspace{0.05cm} n-p-1}
\]</div>
<p><strong>Decision Rule:</strong></p>
<ul>
<li><p>Based on test statistic:</p>
<div class="math notranslate nohighlight">
\[
    \text{Reject} \hspace{0.05cm} H_0   \hspace{0.1cm} \Leftrightarrow \hspace{0.1cm}  F_{exp|H_0} &gt; F_{\alpha}^{\hspace{0.1cm}p,\hspace{0.05cm} n-p-1}
    \]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[
    P(F_{\hspace{0.05cm}p,\hspace{0.05cm} n-p-1} &gt; F_{\alpha}^{\hspace{0.1cm}p,\hspace{0.05cm} n-p-1} ) = \alpha
    \]</div>
</li>
<li><p>Based on p-value:</p>
<div class="math notranslate nohighlight">
\[
    \text{Reject} \hspace{0.05cm} H_0 \hspace{0.1cm} \Leftrightarrow \hspace{0.1cm} p\text{-value} &lt; \alpha
    \]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[
    p\text{-value} =  P(F_{\hspace{0.05cm}p,\hspace{0.05cm} n-p-1} \geq F_{exp|H_0} )
    \]</div>
</li>
</ul>
<p>We can obtain the observed value of the statistic and the pvalue of the test from our class as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">fvalue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2477.6528897026333
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">f_pvalue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="prediction">
<h3><strong>Prediction</strong><a class="headerlink" href="#prediction" title="Link to this heading">#</a></h3>
<p>Once we have estimated the model parameters we can make predictions on the response using data of the predictors.</p>
<p>The prediction of the response for individuals with the value <span class="math notranslate nohighlight">\(x_i \in \mathbb{R}^p\)</span>  for the predictors is:</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i \hspace{0.05cm}=\hspace{0.05cm} \widehat{\beta}_0 + x_i^\prime \cdot \widehat{\beta} \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions - dummies</span>
<span class="n">full_model_inter_dummies</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;n_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_lift&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_parking&#39;</span><span class="p">)]</span>
<span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions</span><span class="p">)</span>
<span class="c1"># Computing predictions</span>
<span class="n">Y_train_hat</span> <span class="o">=</span> <span class="n">full_model_inter_dummies</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="c1"># Computing RMSE</span>
<span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_train_hat</span> <span class="o">-</span> <span class="n">Y_train</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>381995.050363493
</pre></div>
</div>
</div>
</div>
</section>
<section id="predictors-selection">
<h3><strong>Predictors Selection</strong><a class="headerlink" href="#predictors-selection" title="Link to this heading">#</a></h3>
<p>In this section we are going to explore several methods to select predictors.</p>
<p>Given a data set with <span class="math notranslate nohighlight">\(p\)</span> predictors, the number of possible linear regression model that can be trained with a subset (all included) of them is:</p>
<div class="math notranslate nohighlight">
\[\sum_{k=1}^p C(p,k) = \sum_{k=1}^p \dfrac{p!}{k! (p-k)!}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[C(p,k) = \dfrac{p!}{k! (p-k)!}\]</div>
<p>is the  number of possible combinations of <span class="math notranslate nohighlight">\(k\)</span> objects selected from a set of <span class="math notranslate nohighlight">\(p\)</span> objects, without repetition and where the order does not matter, is given by the binomial coefficient:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">binom</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span> <span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">factorial</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">k</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">binom</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4095.0
</pre></div>
</div>
</div>
</div>
<p>In this case we can train 4095 different linear regression model with our data set, that has <span class="math notranslate nohighlight">\(p=12\)</span> predictors.</p>
<p>So, we are interested in a way to select the “best” combination of predictors. There is no definitive method, so, we will see several options.</p>
<section id="significance-test">
<h4><strong>Significance Test</strong><a class="headerlink" href="#significance-test" title="Link to this heading">#</a></h4>
<p>The (individual) significance test (ST) for the predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> consists in testing the following hypothesis</p>
<p>\begin{cases}
H_0 : \beta_j = 0 \
H_1 : \beta_j \neq 0
\end{cases}</p>
<p><strong>Statistic:</strong></p>
<div class="math notranslate nohighlight">
\[t_{exp} \hspace{0.1cm}=\hspace{0.1cm} \dfrac{\widehat{\beta}_j - \beta_j}{\widehat{s_d}(\widehat{\beta}_j)} \hspace{0.1cm}\underset{H_0}{=}\hspace{0.1cm} \dfrac{\widehat{\beta}_j }{\widehat{s_d}(\widehat{\beta}_j)} \hspace{0.1cm}\sim\hspace{0.1cm} t_{n-p-1}\]</div>
<p><strong>p-value:</strong></p>
<div class="math notranslate nohighlight">
\[\text{p-value} = P\left( t_{n-p-1} \hspace{0.1cm}\geq\hspace{0.1cm} \dfrac{\widehat{\beta}_j }{\widehat{s_d}(\widehat{\beta}_j)}\right)\]</div>
<p><strong>Decision rule based in p-value:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\hspace{0.1cm}\text{p-value} &lt; \alpha \hspace{0.1cm} \Rightarrow\hspace{0.1cm}\)</span> Reject <span class="math notranslate nohighlight">\(H_0 \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>  is <strong>significative</strong> to explain the response.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\hspace{0.1cm}\text{p-value}  \geq \alpha \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> Not Reject <span class="math notranslate nohighlight">\(H_0 \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>  is <strong>not significative</strong> to explain the response.</p></li>
</ul>
<p><strong>Decision rule basede in confidence intervals:</strong></p>
<p>This test can be performed with the confidence intervals of the coefficients as follows:</p>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(\hspace{0.1cm}0\in CI(\beta_j)\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> Not reject <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
<li><p>If <span class="math notranslate nohighlight">\(\hspace{0.1cm}0\in CI(\beta_j)\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span>  Reject <span class="math notranslate nohighlight">\(H_0\)</span></p>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P\left(t_{n-p-1} &gt; t^{n-p-1}_{\alpha/2} \right) = \alpha/2\)</span></p></li>
</ul>
</li>
</ul>
<p>The following function allow us to extract the significant predictors of a given linear regression model according to the above test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">significant_test</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span> <span class="p">:</span>

    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">pvalues</span><span class="o">.</span><span class="n">values</span>
    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">pvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">pvalues</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">pvalues</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">significant_results</span> <span class="o">=</span> <span class="n">pvalues</span> <span class="o">&lt;</span> <span class="n">alpha</span>

    <span class="n">significant_predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[</span><span class="n">significant_results</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span>
    <span class="n">not_significant_predictors</span> <span class="o">=</span> <span class="n">predictors</span><span class="p">[</span><span class="n">significant_results</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">significant_results_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_results</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">significant_results_str</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">predictors</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">significant_results_str</span><span class="p">[</span><span class="n">significant_results</span><span class="o">==</span><span class="kc">True</span><span class="p">],</span> 
                         <span class="n">y</span><span class="o">=</span><span class="n">predictors</span><span class="p">[</span><span class="n">significant_results</span><span class="o">==</span><span class="kc">True</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Significance Test&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Significant&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">significant_predictors</span><span class="p">,</span> <span class="n">not_significant_predictors</span>
</pre></div>
</div>
</div>
</div>
<p>The idea is to applied this method to the full model (the one that include all the predictors) to identify which of them are not significative (according to the above test), and therefore we will select one combination of predictors, the significative one.</p>
<p>Since we have four full models, as we explained before, we will apply the test to all of them, and we will obtain a “final” set of predictors in each case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions - dummies</span>
<span class="n">significant_pred_model_inter_dummies_ST</span><span class="p">,</span> <span class="n">not_significant_pred_model_inter_dummies_ST</span> <span class="o">=</span> <span class="n">significant_test</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">full_model_inter_dummies</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c12bb29f2edfcf79c330615e719c68766c5f30530ee307b31490e3c6640a790f.png" src="_images/c12bb29f2edfcf79c330615e719c68766c5f30530ee307b31490e3c6640a790f.png" />
</div>
</div>
<p>Given a categorical predictor, if at least one dummy is significative, we consider the predictor significative. And the same for the interactions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recognition</span><span class="p">(</span><span class="n">initial_list</span><span class="p">):</span>
    <span class="n">output_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">initial_list</span> <span class="p">:</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 
            <span class="n">list_strings</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_strings</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">output_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">output_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">,</span> <span class="n">interactions_selected</span><span class="p">,</span> <span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">significant_pred_model_inter_dummies_ST</span> <span class="o">=</span> <span class="n">recognition</span><span class="p">(</span><span class="n">significant_pred_model_inter_dummies_ST</span><span class="p">)</span>
<span class="n">not_significant</span> <span class="o">=</span> <span class="n">recognition</span><span class="p">(</span><span class="n">not_significant_pred_model_inter_dummies_ST</span><span class="p">)</span>
<span class="n">not_significant_pred_model_inter_dummies_ST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">not_significant</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span><span class="p">])</span> 

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span> <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span>  <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;sq_mt_built&#39;,
 &#39;is_exterior&#39;,
 &#39;floor&#39;,
 &#39;n_bathrooms&#39;,
 &#39;house_type&#39;,
 &#39;energy_certificate&#39;,
 &#39;has_parking&#39;,
 &#39;has_lift&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;sq_mt_built&#39;, &#39;is_exterior&#39;), (&#39;sq_mt_built&#39;, &#39;has_lift&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions </span>
<span class="n">significant_pred_model_inter_ST</span><span class="p">,</span> <span class="n">not_significant_pred_model_inter_ST</span> <span class="o">=</span> <span class="n">significant_test</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">full_model_inter</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3412b96cc76d2d992fecfcfb6283db72427b46b8e8498d7ac2aeeca4456d48c2.png" src="_images/3412b96cc76d2d992fecfcfb6283db72427b46b8e8498d7ac2aeeca4456d48c2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span> <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_ST</span>  <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;sq_mt_built&#39;,
 &#39;is_exterior&#39;,
 &#39;floor&#39;,
 &#39;n_bathrooms&#39;,
 &#39;house_type&#39;,
 &#39;energy_certificate&#39;,
 &#39;has_parking&#39;,
 &#39;has_lift&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;sq_mt_built&#39;, &#39;is_exterior&#39;), (&#39;sq_mt_built&#39;, &#39;has_lift&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - dummies</span>
<span class="n">significant_pred_model_dummies_ST</span><span class="p">,</span> <span class="n">not_significant_pred_model_dummies_ST</span> <span class="o">=</span> <span class="n">significant_test</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">full_model_dummies</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0106e0df5777c623ef3f2ba3569f1e0c94995195adeea926bfe455454a0d717c.png" src="_images/0106e0df5777c623ef3f2ba3569f1e0c94995195adeea926bfe455454a0d717c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">significant_pred_model_dummies_ST</span> <span class="o">=</span> <span class="n">recognition</span><span class="p">(</span><span class="n">significant_pred_model_dummies_ST</span><span class="p">)</span>
<span class="n">not_significant</span> <span class="o">=</span> <span class="n">recognition</span><span class="p">(</span><span class="n">not_significant_pred_model_dummies_ST</span><span class="p">)</span>
<span class="n">not_significant_pred_model_dummies_ST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">not_significant</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">significant_pred_model_dummies_ST</span><span class="p">])</span> 

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">significant_pred_model_dummies_ST</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;sq_mt_allotment&#39;, &#39;sq_mt_built&#39;, &#39;n_floors&#39;, &#39;n_bathrooms&#39;,
       &#39;floor&#39;, &#39;is_renewal_needed&#39;, &#39;is_exterior&#39;, &#39;energy_certificate&#39;,
       &#39;house_type&#39;, &#39;has_parking&#39;, &#39;has_lift&#39;, &#39;n_rooms&#39;], dtype=&#39;&lt;U18&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - not interactions - not dummies</span>
<span class="n">significant_pred_model_basic_ST</span><span class="p">,</span> <span class="n">not_significant_pred_model_basic_ST</span> <span class="o">=</span> <span class="n">significant_test</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">full_model_basic</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7965a6ace1b6b25701d899889ec59e55a68c5b3d4f4a1f4ae830c4517b22928a.png" src="_images/7965a6ace1b6b25701d899889ec59e55a68c5b3d4f4a1f4ae830c4517b22928a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">significant_pred_model_basic_ST</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;ST_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;ST_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;ST_basic&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;sq_mt_built&#39;, &#39;n_rooms&#39;, &#39;n_bathrooms&#39;, &#39;n_floors&#39;,
       &#39;sq_mt_allotment&#39;, &#39;floor&#39;, &#39;is_renewal_needed&#39;, &#39;has_lift&#39;,
       &#39;is_exterior&#39;, &#39;energy_certificate&#39;, &#39;has_parking&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
</section>
<section id="likelihood-ratio-test">
<h4><strong>Likelihood Ratio Test</strong><a class="headerlink" href="#likelihood-ratio-test" title="Link to this heading">#</a></h4>
<p><strong>Deviance</strong></p>
<p>Given an statistical regression model <span class="math notranslate nohighlight">\(M\)</span>, such as Poisson regression model, its deviance is defined as:</p>
<div class="math notranslate nohighlight">
\[D(M) = -2 \cdot log \left( \mathcal{L}(\widehat{\beta}_0, \widehat{\beta}) \right)\]</div>
<p>Where <span class="math notranslate nohighlight">\(\mathcal{L}(\widehat{\beta}_0, \widehat{\beta})\)</span> is the estimated Likelihood function of the model.</p>
<p>The deviance is a measure of how well the model is fitting the training data, so, is a measure of <strong>goodness of fit</strong> of the model.</p>
<p><strong>Properties:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(D(M)\in [0, \infty)\)</span></p></li>
<li><p>The larger <span class="math notranslate nohighlight">\(D(M)\)</span>, the worse <span class="math notranslate nohighlight">\(M\)</span> fits the training data.</p></li>
<li><p>The smaller <span class="math notranslate nohighlight">\(D(M)\)</span>, the better <span class="math notranslate nohighlight">\(M\)</span> fits the training data.</p></li>
<li><p>The null model <span class="math notranslate nohighlight">\(M_0\)</span> (the one that doesn’t include predictors) has the maximum deviance.</p></li>
<li><p>The classic determination coefficient <span class="math notranslate nohighlight">\(R\)</span>-square can be obtain through the deviance as <span class="math notranslate nohighlight">\(\hspace{0.05cm}R^2(M) = 1 - \dfrac{D(M)}{D(M_0)}\)</span></p></li>
</ul>
<p><strong>Likelihood Ratio Test as significance test</strong></p>
<p>Originally the Likelihood ratio test is a test to compare the goodness of fit of different nested models, but in this section we are going to adapt it to be a significance test for the predictors.</p>
<p>Given two nested models <span class="math notranslate nohighlight">\(M_p\)</span>, <span class="math notranslate nohighlight">\(M_{p-1}\)</span> such that <span class="math notranslate nohighlight">\(M_p\)</span> is the full model (includes the <span class="math notranslate nohighlight">\(p\)</span> available predictors) and <span class="math notranslate nohighlight">\(M_{p-1}\)</span> is the same model but without the predictor <span class="math notranslate nohighlight">\(X_j\)</span>.</p>
<p>The significant test for predictor <span class="math notranslate nohighlight">\(X_j\)</span> can be perform as a Likelihood Ratio Test:</p>
<p>\begin{cases}
H_0 : M_{p-1}  \
H_1 : M_p
\end{cases}</p>
<p><strong>Statistic:</strong></p>
<div class="math notranslate nohighlight">
\[LTR = D(M_{p-1}) - D(M_p) \sim \chi_{1}^2\]</div>
<p><strong>p-value:</strong></p>
<div class="math notranslate nohighlight">
\[pvalue = P(\chi_{1}^2 \geq LRT)\]</div>
<p><strong>Decision rule:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(pvalue &lt; \alpha \hspace{0.1cm} \Rightarrow\hspace{0.1cm}\)</span> Reject <span class="math notranslate nohighlight">\(H_0 \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span>  <span class="math notranslate nohighlight">\(M_p\)</span> fits better the training data than <span class="math notranslate nohighlight">\(M_{p-1}\)</span>    <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>  is <strong>significative</strong> to explain the response.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(pvalue \geq \alpha \hspace{0.1cm} \Rightarrow\hspace{0.1cm}\)</span> Not Reject <span class="math notranslate nohighlight">\(H_0 \hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span>  <span class="math notranslate nohighlight">\(M_{p-1}\)</span> fits better the training data than <span class="math notranslate nohighlight">\(M_{p}\)</span>  <span class="math notranslate nohighlight">\(\hspace{0.1cm}\Rightarrow\hspace{0.1cm}\)</span> predictor <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>  is <strong>not significative</strong> to explain the response.</p></li>
</ul>
<p>Let’s implements the Likelihood Test Ratio as significance test in <code class="docutils literal notranslate"><span class="pre">Python</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">LRT</span><span class="p">(</span><span class="n">full_model</span><span class="p">,</span> <span class="n">predictor_to_test</span><span class="p">)</span> <span class="p">:</span>

    <span class="n">X_full</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">X</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">Y</span>
    <span class="n">interactions</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">interactions_to_add</span>
    <span class="n">pred_to_dummies</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">pred_to_dummies</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">X_full</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">predictor_to_test</span> <span class="ow">in</span> <span class="n">predictors</span><span class="p">:</span>
        <span class="n">predictors_reduced</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">predictor_to_test</span><span class="p">]</span>
        <span class="n">interactions_reduced</span> <span class="o">=</span> <span class="p">[(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="n">cat</span> <span class="o">!=</span> <span class="n">predictor_to_test</span> <span class="ow">and</span> <span class="n">quant</span> <span class="o">!=</span> <span class="n">predictor_to_test</span><span class="p">]</span> <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">pred_to_dummies_reduced</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred_to_dummies</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">predictor_to_test</span><span class="p">]</span> <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">elif</span> <span class="n">predictor_to_test</span> <span class="ow">in</span> <span class="n">interactions</span><span class="p">:</span>
        <span class="n">predictors_reduced</span> <span class="o">=</span> <span class="n">predictors</span>
        <span class="n">interactions_reduced</span> <span class="o">=</span> <span class="p">[(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="o">!=</span> <span class="n">predictor_to_test</span><span class="p">]</span>
        <span class="n">pred_to_dummies_reduced</span> <span class="o">=</span> <span class="n">pred_to_dummies</span>

    <span class="n">reduced_model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_full</span><span class="p">[</span><span class="n">predictors_reduced</span><span class="p">])</span>
    <span class="n">reduced_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies_reduced</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_reduced</span><span class="p">)</span>

    <span class="n">loglike_full</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">llf</span>
    <span class="n">loglike_reduced</span> <span class="o">=</span> <span class="n">reduced_model</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">llf</span>
    <span class="n">deviance_full</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">loglike_full</span>
    <span class="n">deviance_reduced</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">loglike_reduced</span>
    <span class="n">LRT_</span> <span class="o">=</span> <span class="n">deviance_reduced</span> <span class="o">-</span> <span class="n">deviance_full</span>
    <span class="n">df_full</span> <span class="o">=</span> <span class="n">full_model</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">df_model</span> <span class="c1"># number of coefficients of full model</span>
    <span class="n">df_reduced</span> <span class="o">=</span> <span class="n">reduced_model</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">df_model</span> <span class="c1"># number of coefficients of reduced model </span>
    <span class="n">pvalue</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">LRT_</span><span class="p">,</span> <span class="n">df_full</span><span class="o">-</span><span class="n">df_reduced</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pvalue</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span> <span class="p">:</span>

    <span class="k">if</span> <span class="n">full_model</span><span class="o">.</span><span class="n">interactions_to_add</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="n">predictors_to_test</span> <span class="o">=</span>  <span class="n">full_model</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="n">full_model</span><span class="o">.</span><span class="n">interactions_to_add</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">predictors_to_test</span> <span class="o">=</span>  <span class="n">full_model</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="n">pvalue</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">predictor</span> <span class="ow">in</span> <span class="n">predictors_to_test</span> <span class="p">:</span>
        <span class="n">pvalue</span><span class="p">[</span><span class="n">predictor</span><span class="p">]</span> <span class="o">=</span> <span class="n">LRT</span><span class="p">(</span><span class="n">full_model</span><span class="p">,</span> <span class="n">predictor_to_test</span><span class="o">=</span><span class="n">predictor</span><span class="p">)</span>
    
    <span class="n">predictors_tested</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pvalue</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
    <span class="n">pvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pvalue</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
    <span class="n">significance_results</span> <span class="o">=</span> <span class="n">pvalues</span> <span class="o">&lt;</span> <span class="n">alpha</span>
    <span class="n">significant_predictors</span> <span class="o">=</span> <span class="n">predictors_tested</span><span class="p">[</span><span class="n">significance_results</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span>
    <span class="n">not_significant_predictors</span> <span class="o">=</span> <span class="n">predictors_tested</span><span class="p">[</span><span class="n">significance_results</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
    <span class="n">significance_test_results_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significance_results</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">significance_test_results_str</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">predictors_tested</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">significance_test_results_str</span><span class="p">[</span><span class="n">significance_results</span><span class="o">==</span><span class="kc">True</span><span class="p">],</span> 
                         <span class="n">y</span><span class="o">=</span><span class="n">predictors_tested</span><span class="p">[</span><span class="n">significance_results</span><span class="o">==</span><span class="kc">True</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Significance Test - LRT&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Significant&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">significant_predictors</span><span class="p">,</span> <span class="n">not_significant_predictors</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model LRT - interactions - dummies</span>
<span class="n">significant_pred_model_inter_dummies_LRT</span><span class="p">,</span> <span class="n">not_significant_pred_model_inter_dummies_LRT</span> <span class="o">=</span> <span class="n">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="o">=</span><span class="n">full_model_inter_dummies</span><span class="p">,</span> 
                                                                                                              <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/156a194888dfe5ea5b6a5be48f34a0b7e54ab2d50e6971e723ac727a8e65eded.png" src="_images/156a194888dfe5ea5b6a5be48f34a0b7e54ab2d50e6971e723ac727a8e65eded.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">significant_pred_model_inter_dummies_LRT</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;sq_mt_built&#39;, &#39;n_rooms&#39;, &#39;n_bathrooms&#39;, &#39;floor&#39;, &#39;has_lift&#39;,
       &#39;is_exterior&#39;, &#39;energy_certificate&#39;, &#39;has_parking&#39;, &#39;house_type&#39;,
       &quot;(&#39;sq_mt_built&#39;, &#39;is_exterior&#39;)&quot;, &quot;(&#39;sq_mt_built&#39;, &#39;has_lift&#39;)&quot;],
      dtype=&#39;&lt;U30&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">not_significant_pred_model_inter_dummies_LRT</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;n_floors&#39;, &#39;sq_mt_allotment&#39;, &#39;is_renewal_needed&#39;,
       &quot;(&#39;n_rooms&#39;, &#39;is_exterior&#39;)&quot;, &quot;(&#39;sq_mt_built&#39;, &#39;has_parking&#39;)&quot;],
      dtype=&#39;&lt;U30&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_LRT</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_dummies_LRT</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;sq_mt_built&#39;,
 &#39;n_rooms&#39;,
 &#39;n_bathrooms&#39;,
 &#39;floor&#39;,
 &#39;has_lift&#39;,
 &#39;is_exterior&#39;,
 &#39;energy_certificate&#39;,
 &#39;has_parking&#39;,
 &#39;house_type&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;sq_mt_built&#39;, &#39;is_exterior&#39;), (&#39;sq_mt_built&#39;, &#39;has_lift&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - interactions </span>
<span class="n">significant_pred_model_inter_LRT</span><span class="p">,</span> <span class="n">not_significant_pred_model_inter_LRT</span> <span class="o">=</span> <span class="n">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="o">=</span><span class="n">full_model_inter</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d5f21a1e7bde1b4e18a992616f4d9634e3c186104b12f1b13e9b66d8697fbc94.png" src="_images/d5f21a1e7bde1b4e18a992616f4d9634e3c186104b12f1b13e9b66d8697fbc94.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_LRT</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">significant_pred_model_inter_LRT</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;sq_mt_built&#39;,
 &#39;n_rooms&#39;,
 &#39;n_bathrooms&#39;,
 &#39;n_floors&#39;,
 &#39;has_lift&#39;,
 &#39;is_exterior&#39;,
 &#39;energy_certificate&#39;,
 &#39;has_parking&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;sq_mt_built&#39;, &#39;is_exterior&#39;), (&#39;sq_mt_built&#39;, &#39;has_lift&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - dummies</span>
<span class="n">significant_pred_model_dummies_LRT</span><span class="p">,</span> <span class="n">not_significant_pred_model_dummies_LRT</span> <span class="o">=</span> <span class="n">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="o">=</span><span class="n">full_model_dummies</span><span class="p">,</span> 
                                                                                                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/68bb006c9de65d61a03467b80307afb9db9461d851629a29bd85de72671a2802.png" src="_images/68bb006c9de65d61a03467b80307afb9db9461d851629a29bd85de72671a2802.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">significant_pred_model_dummies_LRT</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;LRT_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;sq_mt_built&#39;, &#39;n_rooms&#39;, &#39;n_bathrooms&#39;, &#39;n_floors&#39;,
       &#39;sq_mt_allotment&#39;, &#39;floor&#39;, &#39;is_renewal_needed&#39;, &#39;has_lift&#39;,
       &#39;is_exterior&#39;, &#39;energy_certificate&#39;, &#39;has_parking&#39;, &#39;house_type&#39;],
      dtype=&#39;&lt;U18&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full model - basic (not interactions - not dummies)</span>
<span class="n">significant_pred_model_basic_LRT</span><span class="p">,</span> <span class="n">not_significant_pred_model_basic_LRT</span> <span class="o">=</span> <span class="n">LTR_significant_test</span><span class="p">(</span><span class="n">full_model</span><span class="o">=</span><span class="n">full_model_basic</span><span class="p">,</span> 
                                                                                              <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/58f8de4223f537bb45ebc16cf23a512acd9e74002d5b3989469ca64a2bd00869.png" src="_images/58f8de4223f537bb45ebc16cf23a512acd9e74002d5b3989469ca64a2bd00869.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">significant_pred_model_basic_LRT</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;LRT_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_basic&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;sq_mt_built&#39;, &#39;n_rooms&#39;, &#39;n_bathrooms&#39;, &#39;n_floors&#39;,
       &#39;sq_mt_allotment&#39;, &#39;floor&#39;, &#39;is_renewal_needed&#39;, &#39;has_lift&#39;,
       &#39;is_exterior&#39;, &#39;energy_certificate&#39;, &#39;has_parking&#39;, &#39;house_type&#39;],
      dtype=&#39;&lt;U18&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="predictors-selection-based-on-predictive-performance">
<h4><strong>Predictors selection based on predictive performance</strong><a class="headerlink" href="#predictors-selection-based-on-predictive-performance" title="Link to this heading">#</a></h4>
<p>The idea is to consider the predictors as hyper-parameters of the model and optimize them using algorithms like grid search and cross validation.</p>
<section id="train-train-train-validate-split">
<h5><strong>Train-Train - Train-Validate split</strong><a class="headerlink" href="#train-train-train-validate-split" title="Link to this heading">#</a></h5>
<p>Since we need to test the predictive performance of the models we need to split train partition in train-train (train2) to train the models and train-validate (val) to test them.</p>
<p>We don’t use test partition in this case since this task implies taking decisions regarding the predictive modeling process and these decisions should be done with the training data, otherwise this can lead to <strong>data leakage</strong>.</p>
<p>The test partition will only be  used to estimate the future performance of our final model.</p>
</section>
<section id="best-subset-selection-algorithm">
<h5><strong>Best subset selection algorithm</strong><a class="headerlink" href="#best-subset-selection-algorithm" title="Link to this heading">#</a></h5>
<p>Best subset selection algorithm :</p>
<p>We have <span class="math notranslate nohighlight">\(p\)</span> predictors.</p>
<ul class="simple">
<li><p>We train all the possible linear models with  <span class="math notranslate nohighlight">\(1\)</span> predictor, and select the one with less test prediction error computed by simple validation <span class="math notranslate nohighlight">\(\Rightarrow M_1^*\)</span></p></li>
<li><p>We train all the possible linear models with  <span class="math notranslate nohighlight">\(2\)</span> predictor, and select the one with less test prediction error computed by simple validation <span class="math notranslate nohighlight">\(\Rightarrow M_2^*\)</span><br />
<span class="math notranslate nohighlight">\(\dots\)</span></p></li>
<li><p>We train all the possible linear models with  <span class="math notranslate nohighlight">\(p-1\)</span> predictor, and select the one with less test prediction error computed by simple validation <span class="math notranslate nohighlight">\(\Rightarrow M_{p-1}^*\)</span></p></li>
<li><p>We train the full linear model <span class="math notranslate nohighlight">\(\Rightarrow M_{p}\)</span></p></li>
</ul>
<p>Among <span class="math notranslate nohighlight">\(M_1^*, M_2^*,\dots, M_{p-1}^*, M_p\)</span> we select the one with less test prediction error, and it is consider the best Poisson model according to best subset selection algorithm.</p>
<p>This method is feasible in this case, because as we saw before, the number of possible linear regression models that can be trained with all the possible subsets of the <span class="math notranslate nohighlight">\(p=12\)</span> predictors is <span class="math notranslate nohighlight">\(4095\)</span>, which is acceptable computationally with the <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> implementation of the linear regression model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>
<span class="n">binom_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">binom</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">binom_values</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Num. Possible combinations&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Num. predictors (k)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Binomial coefficient in Best-subset selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/71236df706b0e50bc1c554f28d3a4c4c95fc6566f63b49bfe9420ddeafc249d5.png" src="_images/71236df706b0e50bc1c554f28d3a4c4c95fc6566f63b49bfe9420ddeafc249d5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simple_validation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">):</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
    <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">RMSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">best_subset_selection</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span> <span class="p">:</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">RMSE</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">predictors</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">n_iter</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>

        <span class="n">predictors_combinations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">predictors_combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">predictors</span><span class="p">,</span> <span class="nb">iter</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">predictors_combi</span> <span class="ow">in</span> <span class="n">predictors_combinations</span><span class="p">:</span>
 
            <span class="n">pred_to_dummies_reduced</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pred_to_dummies</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)]</span> <span class="k">if</span> <span class="n">pred_to_dummies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">interactions_reduced</span> <span class="o">=</span> <span class="p">[(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span> <span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)</span> <span class="ow">and</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)]</span> <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">RMSE</span><span class="p">[</span><span class="n">predictors_combi</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_validation</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">predictors_combi</span><span class="p">)],</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                                       <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies_reduced</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_reduced</span><span class="p">)</span>

        <span class="n">RMSE_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">RMSE_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="n">best_predictors</span> <span class="o">=</span> <span class="n">RMSE_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">best_interactions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([(</span><span class="n">quant</span><span class="p">,</span><span class="n">cat</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">quant</span><span class="p">,</span><span class="n">cat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">interactions</span> <span class="k">if</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_predictors</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_predictors</span><span class="p">)])</span> <span class="k">if</span> <span class="n">interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">best_interactions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">best_predictors</span> <span class="o">+</span> <span class="n">best_interactions</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">best_predictors</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_values</span><span class="p">)</span> 
        <span class="c1"># Clean the dictionary</span>
        <span class="n">RMSE</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Models with: dummies - interactions</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">best_subset_selection</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> 
                                <span class="n">interactions</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;n_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_lift&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_parking&#39;</span><span class="p">)])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_bestsubset_inter_dummies_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_bestsubset_inter_dummies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_bestsubset_inter_dummies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_bestsubset_inter_dummies</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_bestsubset_inter_dummies</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter_dummies&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;is_renewal_needed&#39;, &#39;has_lift&#39;, &#39;is_exterior&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_bestsubset_inter_dummies</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_bestsubset_inter_dummies_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Best-subset Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fbe9ab95d6ffeb6ea13375fc97ebccb6c0436946c5317f33d72e47e4436f3f99.png" src="_images/fbe9ab95d6ffeb6ea13375fc97ebccb6c0436946c5317f33d72e47e4436f3f99.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Models with: dummies</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">best_subset_selection</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">cat_predictors</span><span class="p">,</span> 
                                <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_bestsubset_dummies_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_bestsubset_dummies</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_bestsubset_dummies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_pred_bestsubset_dummies</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;BestSubset_dummies&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_dummies&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_dummies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;is_renewal_needed&#39;, &#39;has_lift&#39;, &#39;is_exterior&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_bestsubset_dummies</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_bestsubset_dummies_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Best-subset Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/93ec358a58469aebbbe5541dc835e888428c1ab927b1fcf880163fef80d4744b.png" src="_images/93ec358a58469aebbbe5541dc835e888428c1ab927b1fcf880163fef80d4744b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Models with: interactions</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">best_subset_selection</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                      <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                      <span class="n">interactions</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;n_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_lift&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_parking&#39;</span><span class="p">)])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_bestsubset_inter_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_bestsubset_inter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_bestsubset_inter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_bestsubset_inter</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">best_pred_bestsubset_inter</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)]</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;sq_mt_built&#39;,
 &#39;n_rooms&#39;,
 &#39;n_bathrooms&#39;,
 &#39;n_floors&#39;,
 &#39;has_lift&#39;,
 &#39;is_exterior&#39;,
 &#39;energy_certificate&#39;,
 &#39;house_type&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;n_rooms&#39;, &#39;is_exterior&#39;),
 (&#39;sq_mt_built&#39;, &#39;is_exterior&#39;),
 (&#39;sq_mt_built&#39;, &#39;has_lift&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_bestsubset_inter</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_bestsubset_inter_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Best-subset Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8cb345ce43c6d669cb9e3fe588df900d8b4d7954e703ab71bd4a6d0a6c98ab07.png" src="_images/8cb345ce43c6d669cb9e3fe588df900d8b4d7954e703ab71bd4a6d0a6c98ab07.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># basic (not inter - not dummies)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">best_subset_selection</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                      <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                      <span class="n">interactions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_predictors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
<span class="n">result_predictors_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
<span class="n">result_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">best_pred_bestsubset_basic_str</span> <span class="o">=</span> <span class="n">result_predictors_str</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">best_pred_bestsubset_basic</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result_predictors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">result_score</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">best_RMSE_bestsubset_basic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>

<span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_pred_bestsubset_basic</span> 
<span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">pred_to_dummies</span><span class="p">[</span><span class="s1">&#39;BestSubset_basic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_basic&#39;</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;sq_mt_built&#39;,
 &#39;n_rooms&#39;,
 &#39;n_bathrooms&#39;,
 &#39;n_floors&#39;,
 &#39;sq_mt_allotment&#39;,
 &#39;floor&#39;,
 &#39;has_lift&#39;,
 &#39;is_exterior&#39;,
 &#39;energy_certificate&#39;,
 &#39;has_parking&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;BestSubset_basic&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">result_score</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">result_predictors_str</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">best_RMSE_bestsubset_basic</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">best_pred_bestsubset_basic_str</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Best-subset Selection&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predictors&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">result_score</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/232eaad1f2f3f5c772c381a11661318077848ee1c137e5a267f223f7c9089e5c.png" src="_images/232eaad1f2f3f5c772c381a11661318077848ee1c137e5a267f223f7c9089e5c.png" />
</div>
</div>
<p>Backward and forward are not necessary in this case since we have been able to perform best-subset, that explore all the possible combinations of predictors (included the ones explore with backward and forward).</p>
</section>
</section>
</section>
<section id="model-selection">
<h3><strong>Model selection</strong><a class="headerlink" href="#model-selection" title="Link to this heading">#</a></h3>
<p>Since we we want to compare different models based on their predictive performance we need to use train-train (train2) to train them and train-validate (val) to test them, so that we will be able to compare their “real” predictive performance and choose the best one.</p>
<p>We don’t use test partition in model selection because it is part of training, since implies taking decisions regarding the predictive modeling process and this can lead to <strong>data leakage</strong>.</p>
<p>The test partition will only be  used  to estimate the future performance of our final model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">repeated_simple_validation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">):</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">seed_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9999999</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">)</span>
    <span class="n">RMSE_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="p">)</span> <span class="p">:</span>
        
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed_arr</span><span class="p">[</span><span class="nb">iter</span><span class="p">])</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="c1"># If X_test contains categorical variable without some categories that are present in X_train, an error will occur.</span>
            <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">RMSE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">continue</span>

    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RMSE_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RMSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kfold_cv</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">,</span> <span class="p">):</span>

    
    <span class="n">kfold</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">folds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">kfold</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">))</span>
    <span class="n">RMSE_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">)</span> <span class="p">:</span>

        <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="nb">iter</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span> <span class="p">;</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="nb">iter</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span>
        <span class="n">Y_train</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="nb">iter</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="p">;</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">folds</span><span class="p">[</span><span class="nb">iter</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="c1"># If X_test contains categorical variable without some categories that are present in X_train, an error will occur.</span>
            <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">RMSE_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">continue</span>

    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">RMSE_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">RMSE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_rep_sv</span><span class="p">,</span> <span class="n">RMSE_kfold</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_selected</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">RMSE_rep_sv</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">repeated_simple_validation</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="n">x</span><span class="p">]],</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">n_repetitions</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                                                 <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                                                 <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> 
                                                                 <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_selected</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

    <span class="n">RMSE_kfold</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">kfold_cv</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="n">x</span><span class="p">]],</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                              <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> 
                                              <span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> 
                                              <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_selected</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ST_inter_dummies
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ST_inter
ST_dummies
ST_basic
LRT_inter_dummies
LRT_inter
LRT_dummies
LRT_basic
BestSubset_inter_dummies
BestSubset_dummies
BestSubset_inter
BestSubset_basic
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_rep_sv_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE_rep_sv</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">RMSE_kfold_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE_kfold</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">Models_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Linear_&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RMSE_rep_sv</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>

<span class="n">Best_Model_rep_sv</span> <span class="o">=</span> <span class="n">Models_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">RMSE_rep_sv_arr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">RMSE_Best_Model_rep_sv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_rep_sv_arr</span><span class="p">)</span>

<span class="n">Best_Model_kfold</span> <span class="o">=</span> <span class="n">Models_arr</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">RMSE_Best_Model_kfold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_rep_sv_arr</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Models_arr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_Best_Model_rep_sv</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Best_Model_rep_sv</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Selection - Rep. Simple Validation&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE (Repeated simple validation)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_rep_sv_arr</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">RMSE_rep_sv_arr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5d78944972acb314d7362a608ac414436c63af5af0d5a4dc4974f079cf5f759b.png" src="_images/5d78944972acb314d7362a608ac414436c63af5af0d5a4dc4974f079cf5f759b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_kfold_arr</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Models_arr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_Best_Model_kfold</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Best_Model_kfold</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Selection - kfold CV&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE (kfold CV)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">)</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/079be80c8063f0945685665c5bfa3c490551ab7f060bbf21840bfc87054129db.png" src="_images/079be80c8063f0945685665c5bfa3c490551ab7f060bbf21840bfc87054129db.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_kfold_arr</span><span class="p">[</span><span class="n">RMSE_kfold_arr</span> <span class="o">&lt;</span> <span class="mi">400000</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Models_arr</span><span class="p">[</span><span class="n">RMSE_kfold_arr</span> <span class="o">&lt;</span> <span class="mi">400000</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">RMSE_Best_Model_kfold</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Best_Model_kfold</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model Selection - kfold CV&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RMSE (kfold CV)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">[</span><span class="n">RMSE_kfold_arr</span> <span class="o">&lt;</span> <span class="mi">400000</span><span class="p">])</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">RMSE_kfold_arr</span><span class="p">[</span><span class="n">RMSE_kfold_arr</span> <span class="o">&lt;</span> <span class="mi">400000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3ad681a7dfa4a6aabbad7f8d0a2058200b9b94e3c0c87d6c198172df883bab6b.png" src="_images/3ad681a7dfa4a6aabbad7f8d0a2058200b9b94e3c0c87d6c198172df883bab6b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Best_Model_rep_sv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Linear_LRT_inter&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_Best_Model_rep_sv</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>386539.9511010434
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Best_Model_kfold</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Linear_LRT_inter&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_Best_Model_kfold</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>388569.913637558
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;sq_mt_built&#39;,
 &#39;n_rooms&#39;,
 &#39;n_bathrooms&#39;,
 &#39;n_floors&#39;,
 &#39;has_lift&#39;,
 &#39;is_exterior&#39;,
 &#39;energy_certificate&#39;,
 &#39;has_parking&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;sq_mt_built&#39;, &#39;is_exterior&#39;), (&#39;sq_mt_built&#39;, &#39;has_lift&#39;)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="estimation-of-future-performance">
<h3><strong>Estimation of future performance</strong><a class="headerlink" href="#estimation-of-future-performance" title="Link to this heading">#</a></h3>
<p>In this section we are going to estimate the future predictive performance of the best model (the one selected in the precious section).
To estimate the future performance of the model we will use the training partition to train the model and the testing to make predictions an estimate the error, i.e, its future performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statsmodels doesn&#39;t work with Polars but Pandas.</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]])</span>
<span class="n">best_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">])</span>
<span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]])</span>
<span class="n">RMSE_future_performance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RMSE_future_performance</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>423290.67658042104
</pre></div>
</div>
</div>
</div>
</section>
<section id="prediction-intervals">
<h3><strong>Prediction intervals</strong><a class="headerlink" href="#prediction-intervals" title="Link to this heading">#</a></h3>
<p>We have the following property:</p>
<div class="math notranslate nohighlight">
\[
y_i \hspace{0.1cm} \sim \hspace{0.1cm} N \left(  \beta_0 + x_i^\prime \cdot \beta \hspace{0.05cm},\hspace{0.1cm} \sigma^2   \right)
\]</div>
<div class="math notranslate nohighlight">
\[
\widehat{y}_i = \beta_0 + x_i^\prime \cdot \widehat{\beta} \hspace{0.1cm} \sim \hspace{0.1cm} N \left(  \beta_0 + x_i^\prime \cdot \beta \hspace{0.05cm},\hspace{0.1cm} \sigma^2 \cdot v_{i}  \right)
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(v_{i} \hspace{0.05cm}=\hspace{0.05cm} x_i^\prime \cdot (X^\prime \cdot X)^{-1} \cdot x_i\)</span></p></li>
</ul>
<p>Therefore, we have the following:</p>
<div class="math notranslate nohighlight">
\[
y_i - \hat{y}_i \hspace{0.1cm} \sim \hspace{0.1cm} N(0 \hspace{0.05cm},\hspace{0.12cm} \sigma^2 \cdot (1 + v_{i}))
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(E[y_i - \hat{y}_i] = 0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(Var(y_i - \hat{y}_i) = \sigma^2 \cdot (1 + v_{i})\)</span></p></li>
</ul>
<p>Then, we have the following pivotal quantity, with which we are going to build the prediction interval for a  significance level of <span class="math notranslate nohighlight">\(1-\alpha\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\dfrac{ ( y_i - \hat{y}_i ) - E[y_i - \hat{y}_i]}{\widehat{s_d}(y_i - \hat{y}_i ) } \hspace{0.1cm} =\hspace{0.1cm}  \dfrac{y_i - \hat{y}_i }{\sqrt{\widehat{\sigma}^2 \cdot (1 +  v_{i} ) }} \hspace{0.1cm} \sim \hspace{0.1cm} t_{n-p-1}
\]</div>
<p>Finally, we get the prediction (probability) interval:</p>
<div class="math notranslate nohighlight">
\[
PI\left( \hspace{0.02cm} y_i \hspace{0.02cm} \right)_{1-\alpha}\hspace{0.1cm} =\hspace{0.1cm} \left[\hspace{0.15cm} \hat{y}_i  \hspace{0.15cm}\pm\hspace{0.15cm} t_{\alpha/2}^{n-p-1} \cdot \sqrt{ \widehat{\sigma}^2 \cdot (1 + v_{i} ) } \hspace{0.15cm} \right]
\]</div>
<p><strong>Observation:</strong></p>
<p>In the last interval the  <span class="math notranslate nohighlight">\(y_i\)</span> term is a random variable and not a parameter, so, we cannot talk about confidence interval for <span class="math notranslate nohighlight">\(y_i\)</span>. This is the reason why we call it probability interval, because, as <span class="math notranslate nohighlight">\(y_i\)</span> is a random variable, it makes sense to talk about that the probability of <span class="math notranslate nohighlight">\(y_i\)</span> belonging to the <span class="math notranslate nohighlight">\(PI\left( \hspace{0.02cm} y_i \hspace{0.02cm} \right)_{1-\alpha}\)</span> interval is <span class="math notranslate nohighlight">\(1-\alpha\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prediction_intervals</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">subset_len</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">)):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t_alpha_2</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies</span><span class="p">,</span> <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_to_add</span><span class="p">)</span>
    <span class="n">Y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="n">sigma_2_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">-</span> <span class="n">Y_test_hat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)):</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">X_test</span><span class="p">)</span> <span class="o">@</span> <span class="n">X_test</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">)])</span>
    <span class="n">L1</span> <span class="o">=</span> <span class="n">Y_test_hat</span> <span class="o">-</span> <span class="n">t_alpha_2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_2_est</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">v</span><span class="p">))</span>
    <span class="n">L2</span> <span class="o">=</span> <span class="n">Y_test_hat</span> <span class="o">+</span> <span class="n">t_alpha_2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_2_est</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">v</span><span class="p">))</span>

    <span class="n">prop_Y_test_out_interval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">Y_test</span> <span class="o">&lt;</span> <span class="n">L1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">Y_test</span> <span class="o">&gt;</span> <span class="n">L2</span><span class="p">))</span> 

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">subset_len</span> <span class="o">=</span> <span class="n">subset_len</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_test_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                      <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Response Predictions - Test&#39;</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">L1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">L1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                       <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower bound - Prediction Interval&#39;</span><span class="p">)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">L2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">L2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> 
                       <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;fuchsia&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper bound - Prediction Interval&#39;</span><span class="p">)</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">Y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">subset_len</span><span class="p">])),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Response Real Values - Test&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y_test_hat&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;X_test - Index [0:</span><span class="si">{</span><span class="n">subset_len</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Prediction Intervals - Test Set&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.32</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The percentage of real values of the response (all the red points) that are out of the prediction intervals is&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prop_Y_test_out_interval</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prediction_intervals</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]],</span> <span class="n">Y</span><span class="p">,</span> 
                     <span class="n">pred_to_dummies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                     <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">],</span> 
                     <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">subset_len</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/49122a9889096b71a38ab59a53da8f0eb1aa94152ff18b7c44eed874562b8851.png" src="_images/49122a9889096b71a38ab59a53da8f0eb1aa94152ff18b7c44eed874562b8851.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The percentage of real values of the response (all the red points) that are out of the prediction intervals is 3.99 %
</pre></div>
</div>
</div>
</div>
</section>
<section id="coefficient-interpretation-theory">
<h3><strong>Coefficient Interpretation: theory</strong><a class="headerlink" href="#coefficient-interpretation-theory" title="Link to this heading">#</a></h3>
<section id="without-interactions">
<h4><strong>Without interactions</strong><a class="headerlink" href="#without-interactions" title="Link to this heading">#</a></h4>
<section id="interpretation-of-quantitative-predictors">
<h5><strong>Interpretation of quantitative predictors</strong><a class="headerlink" href="#interpretation-of-quantitative-predictors" title="Link to this heading">#</a></h5>
<p>Suppose that <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> is a <strong>quantitative</strong> variable.</p>
<p>We have the following estimation:</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i = \widehat{\beta}_0 + \widehat{\beta}_{1}\cdot x_{i1} + \dots +  \widehat{\beta}_{j} \cdot x_{ij} + \dots +   \widehat{\beta}_{p}\cdot x_{ip}\]</div>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> increases in <span class="math notranslate nohighlight">\(h&gt;0\)</span> units, in sample terms, the new value of the variable <span class="math notranslate nohighlight">\(X_j\)</span> is <span class="math notranslate nohighlight">\(X_j + c\)</span>, and we can express this as <span class="math notranslate nohighlight">\(X'_j =X_j +c\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i | x_{ij}^\prime = x_{ij} + h \hspace{0.12cm}  - \hspace{0.12cm} \widehat{y}_i |  x_{ij}  \hspace{0.12cm}  = \hspace{0.12cm} h \cdot \widehat{\beta}_j\]</div>
<p><strong>Interpretation:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_j &gt; 0 \hspace{0.02cm}\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> increases in <span class="math notranslate nohighlight">\(\hspace{0.05cm}h \cdot \widehat{\beta}_j\hspace{0.05cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units  if <span class="math notranslate nohighlight">\(x_{ij}\)</span> increases in <span class="math notranslate nohighlight">\(h&gt;0\)</span> units, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_j &lt; 0 \hspace{0.2cm}\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> decreases in <span class="math notranslate nohighlight">\(\hspace{0.05cm}h \cdot \widehat{\beta}_j\hspace{0.05cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units  if <span class="math notranslate nohighlight">\(x_{ij}\)</span> increases in <span class="math notranslate nohighlight">\(h&gt;0\)</span> units, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
<p>Observation: the reasoning is analogous if the predictor decreases rather than increases, but in the opposite sense.</p>
</li>
</ul>
</section>
<section id="interpretation-of-categorical-predictors">
<h5><strong>Interpretation of categorical predictors</strong><a class="headerlink" href="#interpretation-of-categorical-predictors" title="Link to this heading">#</a></h5>
<p>Suppose that <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> is a <strong>categorical</strong> variable with <span class="math notranslate nohighlight">\(g\)</span> categories <span class="math notranslate nohighlight">\((Range(\mathcal{X}_j) = \lbrace 0,1,\dots, g-1\rbrace)\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> enter in the model with <span class="math notranslate nohighlight">\(g-1\)</span> dummy predictors. Considering <span class="math notranslate nohighlight">\(0\)</span> as the reference category, these dummy predictors that enter in the model to represent <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> are the following:</p>
<div class="math notranslate nohighlight">
\[X_{j1},X_{j2},\dots , X_{j(g-1)}\]</div>
<p>with their associated beta parameters:</p>
<div class="math notranslate nohighlight">
\[\beta_{j1}, \beta_{j2}, \dots , \beta_{j(g-1)}\]</div>
<p>Where:</p>
<div class="math notranslate nohighlight">
\[\begin{split}x_{ijr} = \begin{cases}
             1, \quad x_{ij} = r \\
             0, \quad x_{ij} \neq r
             \end{cases}\end{split}\]</div>
<p>Note that <span class="math notranslate nohighlight">\(x_{ijr} = 1\)</span> is equivalent to <span class="math notranslate nohighlight">\(x_{ij} = r\)</span>, and <span class="math notranslate nohighlight">\(x_{ij}=0\)</span> is equivalent to <span class="math notranslate nohighlight">\(x_{ijr}=0\)</span> for all <span class="math notranslate nohighlight">\(\small{r=1,2, \dots, g-1}\)</span>.</p>
<p>The estimation  would be:</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i = \widehat{\beta}_0 + \widehat{\beta}_{1}\cdot x_{i1} + \dots +  \widehat{\beta}_{j1} \cdot x_{i j1} + \widehat{\beta}_{j2} \cdot x_{i j2} + \dots + \widehat{\beta}_{j(g-1)} \cdot x_{i j(g-1)} + \dots +   \widehat{\beta}_{p}\cdot x_{ip}\]</div>
<ul>
<li><p>Comparison between category <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(0\)</span> (the reference category):</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i | x_{ijr}  = r \hspace{0.12cm}  - \hspace{0.12cm} \widehat{y}_i |  x_{ij} =0  \hspace{0.12cm}  = \hspace{0.12cm}  \widehat{\beta}_{jr}\]</div>
<p><strong>Interpretation:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{jr} &gt; 0 \hspace{0.02cm}\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}\widehat{\beta}_{jr}\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units greater if <span class="math notranslate nohighlight">\(x_{ij}=r\)</span>  than if <span class="math notranslate nohighlight">\(x_{ij}=0\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{jr} &lt; 0 \hspace{0.02cm}\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}\widehat{\beta}_{jr}\hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units lower if <span class="math notranslate nohighlight">\(x_{ij}=r\)</span>  than if <span class="math notranslate nohighlight">\(x_{ij}=0\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Comparison between category <span class="math notranslate nohighlight">\(r_1\)</span> and <span class="math notranslate nohighlight">\(r_2\)</span> (the reference category):</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i | x_{ijr}  = r_1 \hspace{0.12cm}  - \hspace{0.12cm} \widehat{y}_i |  x_{ij} = r_2  \hspace{0.12cm}  = \hspace{0.12cm}  \widehat{\beta}_{jr_1} - \widehat{\beta}_{jr_2}\]</div>
<p><strong>Interpretation:</strong></p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2} &gt; 0 \hspace{0.02cm}\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}\widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2} \hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units greater if <span class="math notranslate nohighlight">\(x_{ij}=r_1\)</span>  thant if <span class="math notranslate nohighlight">\(x_{ij}=r_2\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{jr} &lt; 0 \hspace{0.02cm}\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}\widehat{\beta}_{jr_1} -\widehat{\beta}_{jr_2} \hspace{0.1cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units greater if <span class="math notranslate nohighlight">\(x_{ij}=r_1\)</span>  thant if <span class="math notranslate nohighlight">\(x_{ij}=r_2\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
</section>
<section id="with-interactions">
<h4><strong>With interactions</strong><a class="headerlink" href="#with-interactions" title="Link to this heading">#</a></h4>
<p>Suppose that <span class="math notranslate nohighlight">\(X_{j}\)</span> is quantitative and <span class="math notranslate nohighlight">\(X_h\)</span> is categorical with <span class="math notranslate nohighlight">\(g\)</span> categories <span class="math notranslate nohighlight">\(\lbrace 0, 1, \dots, g-1\rbrace\)</span> and the reference category is <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>And also suppose that the model includes an interaction between <span class="math notranslate nohighlight">\(X_j\)</span> and <span class="math notranslate nohighlight">\(X_h\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{split}\widehat{y}_i = \widehat{\beta}_0 + \dots + \widehat{\beta}_j\cdot x_{ij} 
+ \widehat{\beta}_{h1} \cdot x_{i h1} + \dots + \widehat{\beta}_{h(g-1)} \cdot x_{i h(g-1)} + \\[0.15cm]\end{split}\\+ \widehat{\beta}_{jh1}\cdot x_{ij}\cdot x_{ih1} + \dots +   \widehat{\beta}_{jh(g-1)}\cdot x_{ij}\cdot x_{ih(g-1)}\end{aligned}\end{align} \]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\widehat{\beta}_{jh}\)</span> is the coefficient fot he interaction between <span class="math notranslate nohighlight">\(X_j\)</span> and <span class="math notranslate nohighlight">\(X_h\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\widehat{\beta}_{jhr}\)</span> is the coefficient fot he interaction between <span class="math notranslate nohighlight">\(X_j\)</span> and <span class="math notranslate nohighlight">\(X_{hr}\)</span>, i.e. the dummy variable for category <span class="math notranslate nohighlight">\(r\)</span> of <span class="math notranslate nohighlight">\(X_h\)</span>, for <span class="math notranslate nohighlight">\(\small{r=1,2,\dots,g-1}.\)</span></p></li>
</ul>
<section id="quantitative-predictors">
<h5><strong>Quantitative predictors:</strong><a class="headerlink" href="#quantitative-predictors" title="Link to this heading">#</a></h5>
<ul>
<li><p>If <span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span> increases in <span class="math notranslate nohighlight">\(w&gt;0\)</span> units, in sample terms, the new value of the variable <span class="math notranslate nohighlight">\(X_j\)</span> is <span class="math notranslate nohighlight">\(X_j + w\)</span>, and we can express this as <span class="math notranslate nohighlight">\(X'_j =X_j +w\)</span>, then:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{y}_i |x'_{ij} = x_{ij} + w \hspace{0.1cm} - \hspace{0.1cm} \widehat{y}_i |x_{ij} \hspace{0.1cm}=\hspace{0.1cm}  w\cdot \widehat{\beta}_j + w\cdot x_{ih1} \cdot \widehat{\beta}_{jh1}+ \dots + w\cdot x_{ih(g-1)} \cdot \widehat{\beta}_{jh(g-1)} \\[0.3cm]
   = w\cdot \left(\widehat{\beta}_j +  x_{ih1} \cdot \widehat{\beta}_{jh1}+ \dots +  x_{ih(g-1)} \cdot \widehat{\beta}_{jh(g-1)} \right) = \phi(\cdot)\end{split}\]</div>
<p><strong>Interpretation:</strong></p>
<p>Now the interpretation not only depend on the coefficient of the variable, but also on the coefficients and value of the categorical predictor with which an interaction has been set.</p>
<p>For  an individual with <span class="math notranslate nohighlight">\(x_{ih} = r\)</span>, i.e. <span class="math notranslate nohighlight">\(x_{ihr}=1\)</span>, then <span class="math notranslate nohighlight">\(\phi(\cdot) = w\cdot (\widehat{\beta}_j + \widehat{\beta}_{jhr})\)</span>.</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_j + \widehat{\beta}_{jhr} &gt; 0\)</span>, then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}w    (\widehat{\beta}_j + \widehat{\beta}_{jhr})\hspace{0.05cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units higher if <span class="math notranslate nohighlight">\(x_{ij}\)</span> increases in <span class="math notranslate nohighlight">\(w&gt;0\)</span> units, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_j + \widehat{\beta}_{jhr} &lt; 0\)</span> , then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\)</span> is <span class="math notranslate nohighlight">\(w(\widehat{\beta}_j + \widehat{\beta}_{jhr})\hspace{0.05cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units lower if <span class="math notranslate nohighlight">\(x_{ij}\)</span> increases in <span class="math notranslate nohighlight">\(w&gt;0\)</span> units, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
<p>Observation: the reasoning is analogous if the predictor decreases rather than increases, but in the opposite sense.</p>
</li>
</ul>
</section>
<section id="categorical-predictors">
<h5><strong>Categorical predictors:</strong><a class="headerlink" href="#categorical-predictors" title="Link to this heading">#</a></h5>
<ul>
<li><p>Comparison between category <span class="math notranslate nohighlight">\(r\)</span> and <span class="math notranslate nohighlight">\(0\)</span> (the reference category) in <span class="math notranslate nohighlight">\(X_h\)</span>:</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i |x_{ih}=r \hspace{0.1cm} - \hspace{0.1cm} \widehat{y}_i |x_{ih}=0 \hspace{0.1cm}=\hspace{0.1cm} \widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr}\]</div>
<p><strong>Interpretation:</strong></p>
<p>Now the interpretation not only depend on the coefficient of the variable, but also on the coefficients and value of the quantitative predictor with which an interaction has been set.</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr} &gt; 0\)</span> , then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr}\hspace{0.05cm}\)</span>  <span class="math notranslate nohighlight">\(y\)</span>-units greater if <span class="math notranslate nohighlight">\(x_{ih}=r\)</span> than if <span class="math notranslate nohighlight">\(x_{ih}=0\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr} &lt; 0\)</span> <span class="math notranslate nohighlight">\(\hspace{0.15cm}\)</span>, is fulfilled that:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}\widehat{\beta}_{hr} +  x_{ij} \cdot \widehat{\beta}_{jhr}\hspace{0.05cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units lower if <span class="math notranslate nohighlight">\(x_{ih}=r\)</span> than if <span class="math notranslate nohighlight">\(x_{ih}=0\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Comparison between category <span class="math notranslate nohighlight">\(r_1\)</span> and <span class="math notranslate nohighlight">\(r_2\)</span> (the reference category) in <span class="math notranslate nohighlight">\(X_h\)</span>:</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i |x_{ih}=r_1 - \widehat{y}_i |x_{ih}=r_2 = (\widehat{\beta}_{hr_1}- \widehat{\beta}_{hr_2})+  x_{ij} \cdot (\widehat{\beta}_{jhr_1}-\widehat{\beta}_{jhr_2})\]</div>
<p><strong>Interpretation:</strong></p>
<p>Now the interpretation not only depend on the coefficient of the variable, but also on the coefficients and value of the quantitative predictor with which an interaction has been set.</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\((\widehat{\beta}_{hr_1}- \widehat{\beta}_{hr_2})+  x_{ij} \cdot (\widehat{\beta}_{jhr_1}-\widehat{\beta}_{jhr_2}) &gt; 0\)</span>  , then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}(\widehat{\beta}_{hr_1}- \widehat{\beta}_{hr_2})+  x_{ij} \cdot (\widehat{\beta}_{jhr_1}-\widehat{\beta}_{jhr_2})\hspace{0.05cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units higher if <span class="math notranslate nohighlight">\(x_{ih}=r_1\)</span> than if <span class="math notranslate nohighlight">\(x_{ih}=r_2\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\((\widehat{\beta}_{hr_1}- \widehat{\beta}_{hr_2})+  x_{ij} \cdot (\widehat{\beta}_{jhr_1}-\widehat{\beta}_{jhr_2}) &lt; 0\)</span> , then:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\widehat{y}_i\hspace{0.05cm}\)</span> is <span class="math notranslate nohighlight">\(\hspace{0.05cm}(\widehat{\beta}_{hr_1}- \widehat{\beta}_{hr_2})+  x_{ij} \cdot (\widehat{\beta}_{jhr_1}-\widehat{\beta}_{jhr_2})\hspace{0.05cm}\)</span> <span class="math notranslate nohighlight">\(y\)</span>-units lower if <span class="math notranslate nohighlight">\(x_{ih}=r_1\)</span> than if <span class="math notranslate nohighlight">\(x_{ih}=r_2\)</span>, for <span class="math notranslate nohighlight">\(\small{i=1,\dots,n}\)</span>.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="coefficient-interpretation-application">
<h3><strong>Coefficient Interpretation: application</strong><a class="headerlink" href="#coefficient-interpretation-application" title="Link to this heading">#</a></h3>
<p>The best model for prediction may not be the best for interpretation.</p>
<p>In order to make this section more complete, we will use a model with interactions and dummies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictors_interpretation</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;n_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;n_bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;n_floors&#39;</span><span class="p">,</span> 
                              <span class="s1">&#39;has_lift&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">,</span> <span class="s1">&#39;energy_certificate&#39;</span><span class="p">,</span> <span class="s1">&#39;has_parking&#39;</span><span class="p">,</span> <span class="s1">&#39;house_type&#39;</span><span class="p">]</span>

<span class="n">interactions_interpretation</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;n_bathrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;is_exterior&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sq_mt_built&#39;</span><span class="p">,</span> <span class="s1">&#39;has_lift&#39;</span><span class="p">)]</span>

<span class="n">pred_to_dummies_interpretation</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_predictors</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_interpretation</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interpretation_model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="n">predictors_interpretation</span><span class="p">])</span>
<span class="n">interpretation_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pred_to_dummies</span><span class="o">=</span><span class="n">pred_to_dummies_interpretation</span><span class="p">,</span> 
                        <span class="n">interactions_to_add</span><span class="o">=</span><span class="n">interactions_interpretation</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">interpretation_model</span><span class="o">.</span><span class="n">linear_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                 OLS Regression Results                                
=======================================================================================
Dep. Variable:              buy_price   R-squared (uncentered):                   0.857
Model:                            OLS   Adj. R-squared (uncentered):              0.857
Method:                 Least Squares   F-statistic:                              4338.
Date:                Fri, 29 Dec 2023   Prob (F-statistic):                        0.00
Time:                        10:12:38   Log-Likelihood:                     -2.1723e+05
No. Observations:               15217   AIC:                                  4.345e+05
Df Residuals:                   15196   BIC:                                  4.347e+05
Df Model:                          21                                                  
Covariance Type:            nonrobust                                                  
=============================================================================================
                                coef    std err          t      P&gt;|t|      [0.025      0.975]
---------------------------------------------------------------------------------------------
sq_mt_built                1891.5886    386.822      4.890      0.000    1133.372    2649.806
n_rooms                   -4.214e+04   3423.603    -12.309      0.000   -4.89e+04   -3.54e+04
n_bathrooms                1.486e+05   2.29e+04      6.489      0.000    1.04e+05    1.94e+05
n_floors                   7617.8433   1.13e+04      0.676      0.499   -1.45e+04    2.97e+04
has_lift_1                -1.875e+05   9914.230    -18.914      0.000   -2.07e+05   -1.68e+05
is_exterior_1             -2.974e+04    1.4e+04     -2.120      0.034   -5.72e+04   -2238.597
energy_certificate_1      -2.643e+04   1.61e+04     -1.646      0.100   -5.79e+04    5037.501
energy_certificate_2       1.673e+04   1.84e+04      0.909      0.364   -1.94e+04    5.28e+04
energy_certificate_3      -9561.8350   9600.364     -0.996      0.319   -2.84e+04    9256.031
energy_certificate_4       2.722e+04   1.44e+04      1.891      0.059    -990.865    5.54e+04
energy_certificate_5       8.633e+04   1.96e+04      4.394      0.000    4.78e+04    1.25e+05
energy_certificate_6        4.58e+04   2.15e+04      2.130      0.033    3653.324    8.79e+04
energy_certificate_7       6.181e+04    1.9e+04      3.260      0.001    2.46e+04     9.9e+04
has_parking_1             -6.759e+04   7511.460     -8.998      0.000   -8.23e+04   -5.29e+04
house_type_1               2.941e+05   2.98e+04      9.869      0.000    2.36e+05    3.53e+05
house_type_2              -1.205e+04   2.48e+04     -0.486      0.627   -6.06e+04    3.65e+04
house_type_3              -1.071e+05   2.12e+04     -5.046      0.000   -1.49e+05   -6.55e+04
house_type_4               4.747e+04    1.5e+04      3.167      0.002    1.81e+04    7.69e+04
n_bathrooms:is_exterior_1 -3.459e+04   2.32e+04     -1.492      0.136      -8e+04    1.09e+04
sq_mt_built:is_exterior_1   579.6226    387.280      1.497      0.135    -179.493    1338.738
sq_mt_built:has_lift_1     3204.0080     60.319     53.118      0.000    3085.775    3322.241
==============================================================================
Omnibus:                    11583.203   Durbin-Watson:                   2.015
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          1181206.545
Skew:                           2.950   Prob(JB):                         0.00
Kurtosis:                      45.757   Cond. No.                     3.89e+03
==============================================================================

Notes:
[1] R² is computed without centering (uncentered) since the model does not contain a constant.
[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[3] The condition number is large, 3.89e+03. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
</div>
</div>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">sq_mt_built</span></code></strong></p>
<p>The model has a interaction between <code class="docutils literal notranslate"><span class="pre">sq_mt_built</span></code> <span class="math notranslate nohighlight">\((X_j)\)</span> , <code class="docutils literal notranslate"><span class="pre">is_exterior</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span> and <code class="docutils literal notranslate"><span class="pre">has_lift</span></code> <span class="math notranslate nohighlight">\((X_k)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{y}_i | x_{ij}^\prime = x_{ij} + w  \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ij} \hspace{0.2cm} = \hspace{0.2cm} w\cdot (\widehat{\beta}_j + x_{ih1}\cdot \widehat{\beta}_{jh1} + x_{ik1}\cdot \widehat{\beta}_{jk1}) \\[0.2cm] \hspace{5.3cm}   = \hspace{0.2cm} w\cdot (1891.6 + x_{ih1}\cdot 579.6 + x_{ik1}\cdot 3204)\end{split}\]</div>
<p>Observation: <code class="docutils literal notranslate"><span class="pre">is_exterior</span></code> and <code class="docutils literal notranslate"><span class="pre">has_lift</span></code> are binaries <span class="math notranslate nohighlight">\(\lbrace 0, 1\rbrace\)</span>.</p>
<ul class="simple">
<li><p>If the number of sq meters built of a house increases in <span class="math notranslate nohighlight">\(w=50 m^2\)</span>, then:</p>
<ul>
<li><p>If the house is exterior <span class="math notranslate nohighlight">\((x_{ih1}=1)\)</span> and has lift <span class="math notranslate nohighlight">\((x_{ik1}=1)\)</span>, then its price increases in 284066.5 €</p></li>
<li><p>If the house is not exterior <span class="math notranslate nohighlight">\((x_{ih1}=0)\)</span> but has lift <span class="math notranslate nohighlight">\((x_{ik1}=1)\)</span>, then  its price increases in 243765 €</p></li>
<li><p>If the house is exterior <span class="math notranslate nohighlight">\((x_{ih1}=1)\)</span> but doesn’t have lift <span class="math notranslate nohighlight">\((x_{ik1}=0)\)</span>, then its price increases in 123524 €</p></li>
<li><p>If the house is not exterior <span class="math notranslate nohighlight">\((x_{ih1}=0)\)</span> and doesn’t have lift <span class="math notranslate nohighlight">\((x_{ik1}=0)\)</span>, then its price increases in 83222.5 €</p></li>
</ul>
</li>
</ul>
<p>Summarizing:</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">sq_mt_built</span></code> of a house increases, the estimated price increases, but the intensity (quantity) of this increases depend on wether the house is exterior or not and wether has lift or not, because we have establish an interaction between these predictors.</p>
<p>We can make an intensity ranking, from more to less intensity, depending on the values of <code class="docutils literal notranslate"><span class="pre">is_exterior</span></code> <span class="math notranslate nohighlight">\((x_{ih1})\)</span> and <code class="docutils literal notranslate"><span class="pre">has_lift</span></code> <span class="math notranslate nohighlight">\((x_{ik1})\)</span>:</p>
<div class="math notranslate nohighlight">
\[x_{ih1} = x_{ik1} = 1\]</div>
<div class="math notranslate nohighlight">
\[x_{ih1} = 0 \hspace{0.1cm};\hspace{0.1cm}  x_{ik1} = 1\]</div>
<div class="math notranslate nohighlight">
\[x_{ih1} =1 \hspace{0.1cm};\hspace{0.1cm}  x_{ik1} = 0\]</div>
<div class="math notranslate nohighlight">
\[x_{ih1} = x_{ik1} = 0\]</div>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">n_bathrooms</span></code></strong></p>
<p>The model has a interaction between <code class="docutils literal notranslate"><span class="pre">n_bathrooms</span></code> <span class="math notranslate nohighlight">\((X_j)\)</span> and <code class="docutils literal notranslate"><span class="pre">is_exterior</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{y}_i | x_{ij}^\prime = x_{ij} + w  \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ij} \hspace{0.2cm} = \hspace{0.2cm} w\cdot (\widehat{\beta}_j + x_{ih1}\cdot \widehat{\beta}_{jh1} ) \\[0.2cm] \hspace{5.3cm}   = \hspace{0.2cm} w\cdot (148600 - x_{ih1}\cdot 34590 )\end{split}\]</div>
<p>Observation: <code class="docutils literal notranslate"><span class="pre">is_exterior</span></code> is binary <span class="math notranslate nohighlight">\(\lbrace 0, 1\rbrace\)</span>.</p>
<ul class="simple">
<li><p>If the number of bathrooms of a house increases in <span class="math notranslate nohighlight">\(w=1\)</span> bathroom, then:</p>
<ul>
<li><p>If the house is exterior <span class="math notranslate nohighlight">\((x_{ih1}=1)\)</span>, its price increases in 114010 €</p></li>
<li><p>If the house is not exterior <span class="math notranslate nohighlight">\((x_{ih1}=0)\)</span>, its price increases in 148600 €</p></li>
</ul>
</li>
</ul>
<p>In conclusion:</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">n_bathrooms</span></code> of a house increases, the estimated price increases as well, but the intensity (quantity) of this increases depend on wether the house is exterior or not, because we have establish an interaction between these predictors.</p>
<p>If the house is exterior <span class="math notranslate nohighlight">\((x_{ih1}=1)\)</span>, the intensity of the increases is lower than if is not exterior <span class="math notranslate nohighlight">\((x_{ih1}=0)\)</span>.</p>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">n_rooms</span></code></strong></p>
<p>Let suppose that <code class="docutils literal notranslate"><span class="pre">n_rooms</span></code> is <span class="math notranslate nohighlight">\(X_j\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{y}_i | x_{ij}^\prime = x_{ij} + w  \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ij} \hspace{0.2cm} = \hspace{0.2cm} w\cdot \widehat{\beta}_j  \hspace{0.2cm}  \\[0.2cm] \hspace{4.9 cm}   = \hspace{0.2cm}   -w\cdot 42140\end{split}\]</div>
<ul class="simple">
<li><p>If the number of rooms increases in <span class="math notranslate nohighlight">\(w=1\)</span> room, the house price decreases in 42140 €</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">n_floors</span></code></strong></p>
<p>Let suppose that <code class="docutils literal notranslate"><span class="pre">n_floors</span></code> is <span class="math notranslate nohighlight">\(X_j\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{y}_i | x_{ij}^\prime = x_{ij} + w  \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ij} \hspace{0.2cm} = \hspace{0.2cm} w\cdot \widehat{\beta}_j  \hspace{0.2cm}  \\[0.2cm] \hspace{4.9 cm}   = \hspace{0.2cm}   w\cdot 7617.84\end{split}\]</div>
<ul class="simple">
<li><p>If the number of floors increases in <span class="math notranslate nohighlight">\(w=1\)</span> floor, the house price increases in 7617.84 €</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">has_lift</span></code></strong></p>
<p>The model has a interaction between <code class="docutils literal notranslate"><span class="pre">has_lift</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span> and <code class="docutils literal notranslate"><span class="pre">sq_mt_built</span></code> <span class="math notranslate nohighlight">\((X_j)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{y}_i | x_{ih} = 1  \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ih} = 0\hspace{0.2cm} = \hspace{0.2cm}  \widehat{\beta}_{h1} + x_{ij}\cdot \widehat{\beta}_{jh1} ) \\[0.2cm] \hspace{5.3cm}   = \hspace{0.2cm} -187500 + x_{ij}\cdot 1891.6\end{split}\]</div>
<p>Observation: <code class="docutils literal notranslate"><span class="pre">has_lift</span></code> is binary <span class="math notranslate nohighlight">\(\lbrace 0, 1\rbrace\)</span>.</p>
<ul class="simple">
<li><p>For houses with 150 sq meters built, their price is 96150€ greater if they have lift than if not.</p></li>
<li><p>For house with 90 sq meter built, their price is 17256 € lower if they have lift than if not.</p></li>
</ul>
<p>In conclusion:</p>
<ul class="simple">
<li><p>For big houses, tho have a lift increases the price.</p></li>
<li><p>For small houses, tho have a lift decreases the price.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">is_exterior</span></code></strong></p>
<p>The model has a interaction between <code class="docutils literal notranslate"><span class="pre">is_exterior</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span>, <code class="docutils literal notranslate"><span class="pre">n_bathrooms</span></code> <span class="math notranslate nohighlight">\((X_j)\)</span> and <code class="docutils literal notranslate"><span class="pre">sq_mt_built</span></code> <span class="math notranslate nohighlight">\((X_k)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{y}_i | x_{ih}=1   \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ih}=0 \hspace{0.2cm} = \hspace{0.2cm}\widehat{\beta}_{h1} + x_{ij}\cdot \widehat{\beta}_{jh1} + x_{ik}\cdot \widehat{\beta}_{kh1}) \\[0.2cm] \hspace{5.1cm}   = \hspace{0.2cm} -29740-x_{ij}\cdot 34590 + x_{ik}\cdot 579.6\end{split}\]</div>
<p>Observation: <code class="docutils literal notranslate"><span class="pre">is_exterior</span></code> is binary <span class="math notranslate nohighlight">\((0,1)\)</span>.</p>
<ul class="simple">
<li><p>For houses with 2 bathrooms and 100 sq meters built, their price is 40960 € lower if are exterior.</p></li>
<li><p>For houses with 2 bathrooms and 200 sq meters built, their price is 17000 € greater if are exterior.</p></li>
<li><p>For houses with 3 bathrooms and 200 sq meters built, their price is 17590 € lower if are exterior.</p></li>
</ul>
<p>In conclusion:</p>
<ul class="simple">
<li><p>Houses with few enough bathrooms and large enough sq meters built are more expensive if are exterior.</p></li>
<li><p>Houses with not few enough bathrooms or not large enough sq meters built are more expensive if are not exterior.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">energy_certificate</span></code></strong></p>
<p><code class="docutils literal notranslate"><span class="pre">energy_certificate</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span> is multiclass with 8 categories <span class="math notranslate nohighlight">\(\lbrace 0,1,\dots , 7\rbrace\)</span>.</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i | x_{ih}=7   \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ih}=0 \hspace{0.2cm} = \hspace{0.2cm} \widehat{\beta}_{h7} = 61810\]</div>
<div class="math notranslate nohighlight">
\[\widehat{y}_i | x_{ih}=7   \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ih}=6 \hspace{0.2cm} = \hspace{0.2cm} \widehat{\beta}_{h7} - \widehat{\beta}_{h6}  = 16010\]</div>
<ul class="simple">
<li><p>Price of houses with energy certificate 7 is 61810€ greater than the one of houses with certificate 0.</p></li>
<li><p>Price of houses with energy certificate 7 is 16010 € greater than the one of houses with certificate 6.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">has_parking</span></code></strong></p>
<p><code class="docutils literal notranslate"><span class="pre">has_parking</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span> is binary <span class="math notranslate nohighlight">\(\lbrace 0, 1\rbrace\)</span></p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i | x_{ih}=1   \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ih}=0 \hspace{0.2cm} = \hspace{0.2cm} \widehat{\beta}_{h1} = -67590\]</div>
<ul class="simple">
<li><p>Price of houses with parking is 67590 € lower than the one of houses with without.</p></li>
</ul>
<p><strong>Interpreting coefficient of <code class="docutils literal notranslate"><span class="pre">house_type</span></code></strong></p>
<p><code class="docutils literal notranslate"><span class="pre">house_type</span></code> <span class="math notranslate nohighlight">\((X_h)\)</span> is multiclass with 4 categories <span class="math notranslate nohighlight">\(\lbrace 0,1,2,3\rbrace\)</span>.</p>
<div class="math notranslate nohighlight">
\[\widehat{y}_i | x_{ih}=1   \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ih}=0 \hspace{0.2cm} = \hspace{0.2cm} \widehat{\beta}_{h1} = 294100\]</div>
<div class="math notranslate nohighlight">
\[\widehat{y}_i | x_{ih}=1   \hspace{0.2cm} - \hspace{0.2cm} \widehat{y}_i | x_{ih}=4 \hspace{0.2cm} = \hspace{0.2cm} \widehat{\beta}_{h1} - \widehat{\beta}_{h4}  = 246630\]</div>
<ul class="simple">
<li><p>Price of houses of type 1 (chalets)   is 294100€ greater than the one of houses type 0 (flats).</p></li>
<li><p>Price of houses of type 1 (chalets)   is 246630 € greater than the one of houses type 4 (top floor).</p></li>
</ul>
</section>
<section id="model-problems">
<h3><strong>Model Problems</strong><a class="headerlink" href="#model-problems" title="Link to this heading">#</a></h3>
<section id="violation-of-model-assumptions">
<h4><strong>Violation of model assumptions</strong><a class="headerlink" href="#violation-of-model-assumptions" title="Link to this heading">#</a></h4>
<p>In this section we will check if the basic model assumptions are fulfilled.</p>
<p>First, since the assumptions are related with the residuals, we estimate them, for the best model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y_train_hat</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">predictors_selected</span><span class="p">[</span><span class="s1">&#39;LRT_inter&#39;</span><span class="p">]])</span>
<span class="n">residuals_est</span> <span class="o">=</span>  <span class="n">Y_train</span> <span class="o">-</span> <span class="n">Y_train_hat</span>
</pre></div>
</div>
</div>
</div>
<section id="violation-of-null-mean-of-the-residuals">
<h5><strong>Violation of null mean of the residuals</strong><a class="headerlink" href="#violation-of-null-mean-of-the-residuals" title="Link to this heading">#</a></h5>
<p>To check the null mean assumption we can perform a t-test on the  residuals along with a plot like the next one (although in this case in not very informative due to the big scale of the response variable).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">residuals_est</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Estimated Residuals&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Residuals mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residuals mean = 558.8809228895557
</pre></div>
</div>
<img alt="_images/351668fa2ad3886695007f3f0cce9cfb1722b696443efe230b049e6f02e2de7f.png" src="_images/351668fa2ad3886695007f3f0cce9cfb1722b696443efe230b049e6f02e2de7f.png" />
</div>
</div>
<p>We compute the pvalue of the t-test for the null mean of the residuals.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_value</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8583305763037111
</pre></div>
</div>
</div>
</div>
<p>For the typical significance level <span class="math notranslate nohighlight">\((\alpha = 0.05)\)</span>, we cannot reject that <span class="math notranslate nohighlight">\(E[\varepsilon_i]=0\)</span>. Therefore, the null mean of the residuals assumption is not fulfilled.</p>
</section>
</section>
<section id="violation-of-constant-variance-of-the-residuals">
<h4><strong>Violation of constant variance of the residuals</strong><a class="headerlink" href="#violation-of-constant-variance-of-the-residuals" title="Link to this heading">#</a></h4>
<p>It is not possible to check the constant variance assumption just  by analyzing the residuals, because some of them will be high and others low, but this doesn’t prove anything.</p>
<p>It is necessary to check if the residual variance is related to any other quantity, so that for certain values of that quantity the residual variance is bigger than for others, and, therefore confirming that it is not constant.</p>
<p>The most useful diagnosis is the scatter plot for <span class="math notranslate nohighlight">\(\widehat{\varepsilon}\)</span> vs <span class="math notranslate nohighlight">\(\widehat{Y}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Y_train_hat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">residuals_est</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Estimated Residuals&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Y_train_hat&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f6c00c9d993364ec7b7f80424a95689549991ef395caaf23a5dd0e4b2ccea87b.png" src="_images/f6c00c9d993364ec7b7f80424a95689549991ef395caaf23a5dd0e4b2ccea87b.png" />
</div>
</div>
</section>
<section id="violation-of-normality-of-the-residuals">
<h4><strong>Violation of Normality of the residuals</strong><a class="headerlink" href="#violation-of-normality-of-the-residuals" title="Link to this heading">#</a></h4>
<p>To check the normality of the residuals we will compare their histogram with the one they would have if would be perfectly normal distributed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normal_residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Estimated Residuals&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">normal_residuals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normal Residuals&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d128fb80b714cb23f090ef888387083b3b438cd6a16b68ea1953c464ae468c7f.png" src="_images/d128fb80b714cb23f090ef888387083b3b438cd6a16b68ea1953c464ae468c7f.png" />
</div>
</div>
<p>We can also use a qq-plot to test normality graphically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">residuals_est</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scale</span><span class="o">=</span><span class="n">residuals_est</span><span class="o">.</span><span class="n">std</span><span class="p">())</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/c33ee07ab0cf9e6dac6ef5e0772292bfd90d2436befab10918ec53ba8fd8e404.png" src="_images/c33ee07ab0cf9e6dac6ef5e0772292bfd90d2436befab10918ec53ba8fd8e404.png" />
</div>
</div>
<p>In this case hypothesis test are not useful due to the number of observation involved in our data. So, our analysis can only be based on this kind of visual tools, which is imprecise.</p>
</section>
<section id="violation-of-null-auto-correlation-of-the-residuals">
<h4><strong>Violation of null auto-correlation of the residuals</strong><a class="headerlink" href="#violation-of-null-auto-correlation-of-the-residuals" title="Link to this heading">#</a></h4>
<p>The residuals null correlation assumption can be check by mean of the Durban-Watson test.</p>
<p>The Durban-Watson test hypothesis are the following:</p>
<div class="math notranslate nohighlight">
\[H_0: \hspace{0.05cm} Corr\left(\varepsilon_{i}\hspace{0.05cm},\hspace{0.05cm} \varepsilon_{i+1}\right) = 0 \hspace{0.05cm} ,\hspace{0.13cm} \forall \hspace{0.1cm}i =1,...,n-1\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}H_1: \hspace{0.05cm}  Corr\left(\varepsilon_{i}\hspace{0.05cm},\hspace{0.05cm} \varepsilon_{i+1}\right) \neq 0 \hspace{0.05cm} ,\hspace{0.13cm} \exists \hspace{0.1cm}i =1,...,n-1 \\[0.5cm]\end{split}\]</div>
<p><strong>Statistic Test:</strong></p>
<div class="math notranslate nohighlight">
\[
DW \hspace{0.05cm}=\hspace{0.05cm} \dfrac{\sum_{i=1}^{n-1} (\hat{\varepsilon}_i - \hat{\varepsilon}_{i+1})^2 }{\sum_{i=1}^{n} \hat{\varepsilon}_{i}^2 }
\]</div>
<p><strong>Interpretation:</strong></p>
<p>The following is fulfilled:</p>
<div class="math notranslate nohighlight">
\[
DW \hspace{0.1cm}\simeq \hspace{0.1cm} 2\cdot (1- r_{12})
\]</div>
<p>where:</p>
<p><span class="math notranslate nohighlight">\(r_{12}\hspace{0.02cm}\)</span>  is the linear correlation between  <span class="math notranslate nohighlight">\(\hspace{0.02cm}\hat{\varepsilon}_{(1)} = (\hat{\varepsilon}_1 , \hat{\varepsilon}_2 ,..., \hat{\varepsilon}_{n-1})\hspace{0.05cm}\)</span> and <span class="math notranslate nohighlight">\(\hspace{0.05cm}\hat{\varepsilon}_{(2)} = (\hat{\varepsilon}_2  ,...,\hat{\varepsilon}_{n-1}, \hat{\varepsilon}_{n})\)</span></p>
<ul class="simple">
<li><p>The statistic test is between <span class="math notranslate nohighlight">\(0\)</span> and <span class="math notranslate nohighlight">\(4\)</span>, because <span class="math notranslate nohighlight">\(r_{12}\)</span> is between <span class="math notranslate nohighlight">\(-1\)</span> and <span class="math notranslate nohighlight">\(1\)</span>.</p></li>
<li><p>An statistic of <span class="math notranslate nohighlight">\(DW=2\)</span> indicates evidence of that residuals are not autocorrelate, so,  evidence in favor of <span class="math notranslate nohighlight">\(H_0\)</span>.</p></li>
<li><p>An statistic of <span class="math notranslate nohighlight">\(DW\)</span> close to <span class="math notranslate nohighlight">\(0\)</span> indicates evidence of that residuals are positively autocorrelate, so,  evidence in favor of <span class="math notranslate nohighlight">\(H_1\)</span>.</p></li>
<li><p>An statistic of <span class="math notranslate nohighlight">\(DW\)</span> close to <span class="math notranslate nohighlight">\(4\)</span> indicates evidence of that residuals are negatively autocorrelate, so,  evidence in favor of <span class="math notranslate nohighlight">\(H_1\)</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuals_est</span> <span class="o">=</span> <span class="n">residuals_est</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">residuals_est_0</span> <span class="o">=</span> <span class="n">residuals_est</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">residuals_est_1</span> <span class="o">=</span> <span class="n">residuals_est</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">residuals_est_0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">residuals_est_1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;errors 0&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;errors 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/59b164e27b533762c00fe38b06bef40006c9c752bd593b0da470f97e987e1d26.png" src="_images/59b164e27b533762c00fe38b06bef40006c9c752bd593b0da470f97e987e1d26.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">residuals_est_0</span><span class="p">,</span> <span class="n">residuals_est_1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.006553447280479784
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">stattools</span><span class="o">.</span><span class="n">durbin_watson</span><span class="p">(</span><span class="n">residuals_est</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.012363440433914
</pre></div>
</div>
</div>
</div>
<p>The Durban Watson statistic is close to <span class="math notranslate nohighlight">\(2\)</span>, what indicate evidence of no auto-correlation of the residuals.</p>
</section>
<section id="multicollinearity">
<h4><strong>Multicollinearity</strong><a class="headerlink" href="#multicollinearity" title="Link to this heading">#</a></h4>
<p>The multicollinearity problem occurs when some of the predictors are linearly dependent.</p>
<p><strong>Why is multicollinearity a problem?</strong></p>
<ul class="simple">
<li><p>In the worst of the cases, the existence of multicollinearity makes impossible the estimation of the model</p></li>
<li><p>In the best of cases, the existence of multicollinearity makes the estimators of the beta coefficients very imprecise, therefore, with high variance. This implies that some significant predictors could be accepted as not significant, because the results of the significance test are affected by the variance of those estimators. The larger the variance of an estimator of the beta coefficient is, the smaller the statistical test of significance will be, and this makes it easier not  rejecting the null hypothesis that the predictor is not significant.</p></li>
</ul>
<section id="perfect-multicollinearity">
<h5><strong>Perfect Multicollinearity</strong><a class="headerlink" href="#perfect-multicollinearity" title="Link to this heading">#</a></h5>
<p>At least one of the predictors is a linear combination of the rest, so,
<span class="math notranslate nohighlight">\(\hspace{0.02cm}Rg(X) \hspace{0.03cm}&lt;\hspace{0.03cm} p+1 \hspace{0.02cm}\)</span>, in other words,  the <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> matrix hasn’t complete range.</p>
<p>Because of the theorem of range-nullity we have te following:</p>
<div class="math notranslate nohighlight">
\[Rg\left({X}^\prime \cdot {X}\right) \hspace{0.03cm}&lt;\hspace{0.03cm} p+1\]</div>
<p>Therefore,  <span class="math notranslate nohighlight">\(\hspace{0.01cm}\mathbf{X}^\prime \cdot {X}\hspace{0.02cm}\)</span> hasn’t complete range, so <span class="math notranslate nohighlight">\(\hspace{0.02cm}\left({X}^\prime\cdot {X}\right)^{-1}\hspace{0.02cm}\)</span> doesn’t exist. As a consequence of the last, <span class="math notranslate nohighlight">\(\hspace{0.02cm}(\beta_0,{\beta})\hspace{0.02cm}\)</span> cannot be estimated with ordinary least squares method (OLS).</p>
</section>
<section id="high-multicollinearity">
<h5><strong>High Multicollinearity</strong><a class="headerlink" href="#high-multicollinearity" title="Link to this heading">#</a></h5>
<p>There are pairs of predictors with high linear correlation among them.</p>
<p>But, even in this case, the estimation of the beta coefficients is still possible, but the variance of the estimators will be very high, so, the estimations will be very imprecise and significant predictors could  be shown as not significant by mean of the significance test.</p>
</section>
<section id="multicollinearity-identification">
<h5><strong>Multicollinearity Identification</strong><a class="headerlink" href="#multicollinearity-identification" title="Link to this heading">#</a></h5>
<p>Multicollinearity identification can be carry out following different ways.</p>
<ul class="simple">
<li><p>If the linear regression model has only <strong>quantitative</strong> predictors:</p>
<ul>
<li><p>With the Pearson correlation matrix of the predictors.</p></li>
<li><p>With the Variance Increment Factor  <span class="math notranslate nohighlight">\(VIF\)</span> .</p></li>
<li><p>With the conditioning number of  the correlation matrix.</p></li>
</ul>
</li>
<li><p>If the linear regression model has both <strong>quantitative</strong> and <strong>categorical</strong> predictors:</p>
<ul>
<li><p>With the Generalized Variance Increment Factor   <span class="math notranslate nohighlight">\(GVIF\)</span>.</p></li>
</ul>
</li>
</ul>
<p>In this project we will not go beyond the first option, in order not to make the project even more extensive.</p>
</section>
<section id="multicollinearity-identification-with-the-linear-correlation-matrix">
<h5><strong>Multicollinearity identification with the linear correlation matrix</strong><a class="headerlink" href="#multicollinearity-identification-with-the-linear-correlation-matrix" title="Link to this heading">#</a></h5>
<p>Assuming that <span class="math notranslate nohighlight">\(\hspace{0.02cm}X=(X_1 ,..., X_p)\hspace{0.02cm}\)</span>  is a quantitative data matrix.</p>
<p>The linear correlation matrix of <span class="math notranslate nohighlight">\(\hspace{0.02cm}X\hspace{0.02cm}\)</span> is define as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\\[0.5cm]
R_{X}= \begin{pmatrix}
    r_{11} &amp; r_{12}&amp;...&amp;r_{1p}\\
    r_{21} &amp; r_{22}&amp;...&amp;r_{2p}\\
    ...&amp;...&amp;...&amp;...\\
    r_{p1}&amp; r_{p2}&amp;...&amp;r_{pp}
\end{pmatrix} = [r_{jh} ]_{\hspace{0.04cm} j,h \hspace{0.02cm} = \hspace{0.02cm}  1,..,p}
\end{split}\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[
r_{j h} = \frac{s_{jh}}{\hspace{0.07cm} s_j \cdot s_h\hspace{0.07cm} } 
\]</div>
<p>is the linear correlation coefficient between <span class="math notranslate nohighlight">\(X_j\)</span> and <span class="math notranslate nohighlight">\(X_h\)</span>, being <span class="math notranslate nohighlight">\(\hspace{0.02cm} s_j = \sigma^2(X_j) \hspace{0.02cm} and \)</span>s_{jh}<span class="math notranslate nohighlight">\(  the covariance  between \)</span>X_j<span class="math notranslate nohighlight">\( and \)</span>X_h<span class="math notranslate nohighlight">\(, i.e:
\)</span><span class="math notranslate nohighlight">\(
s_{jh} \hspace{0.05cm}=\hspace{0.05cm} \frac{\hspace{0.1cm} 1\hspace{0.1cm} }{n} \cdot \sum_{i=1}^{n} \left(\hspace{0.05cm} x_{ij} - \overline{X}_j \hspace{0.05cm}\right)\cdot \left(\hspace{0.05cm} x_{ih} - \overline{X}_h \hspace{0.05cm}\right)
\)</span>$</p>
<p><strong>Criteria:</strong></p>
<p>We have a estimated linear regression model <span class="math notranslate nohighlight">\(\widehat{Y}=\beta_0 + X\cdot \widehat{\beta} \hspace{0.04cm}\)</span>  only with quantitative predictors.</p>
<ul class="simple">
<li><p>If there are any high correlation, namely, <span class="math notranslate nohighlight">\(\hspace{0.02cm} | r_{ih} |\hspace{0.02cm} &gt; \hspace{0.02cm} 0.75 \hspace{0.07cm}\)</span>  <span class="math notranslate nohighlight">\(\Rightarrow\hspace{0.07cm}\)</span> <strong>multicollinearity problems</strong>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix_</span> <span class="o">=</span> <span class="n">corr_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">X_Y_train_df</span><span class="p">,</span> <span class="n">quant_col_names</span><span class="o">=</span><span class="n">quant_columns</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix_</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">tick_top</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/54eef8112466b9142ab39de876536f6d6ebb95c6be9f2d5e4413334e3ed30f05.png" src="_images/54eef8112466b9142ab39de876536f6d6ebb95c6be9f2d5e4413334e3ed30f05.png" />
</div>
</div>
<p>As we can see there are quantitative predictors with high correlation, such as (<code class="docutils literal notranslate"><span class="pre">sq_mt_built</span></code>, <code class="docutils literal notranslate"><span class="pre">n_bathrooms</span></code>). So that, a model that include these predictors may have multicolinearity problems, leading to imprecise estimation of the beta coefficients.</p>
</section>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Modeling Madrid House Prices</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements"><strong>Requirements</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conceptual-description-of-the-data"><strong>Conceptual description of the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-data"><strong>Reading the data</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing"><strong>Data preprocessing</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removing-some-variables"><strong>Removing some variables</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-types"><strong>Data types</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unique-values"><strong>Unique values</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-encoding"><strong>Standard encoding</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#missing-values"><strong>Missing values</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split"><strong>Train-Test Split</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eda"><strong>EDA</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-summary"><strong>Descriptive summary</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#outliers"><strong>Outliers</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#response-analysis"><strong>Response analysis</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#histogram"><strong>Histogram</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#frequencies"><strong>Frequencies</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot"><strong>Boxplot</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ecdf-plot"><strong>ECDF-plot</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relation-between-response-and-predictors"><strong>Relation between response and predictors</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-model"><strong>Linear Regression Model</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-linear-regression"><strong>Why Linear regression?</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions"><strong>Assumptions</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions-consequences"><strong>Assumptions consequences</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matrix-representation-of-the-basic-assumption"><strong>Matrix representation of the basic assumption</strong> <a class="anchor" id="8"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-estimation"><strong>Coefficient estimation</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-deviation-of-coefficients"><strong>Standard deviation of coefficients</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-intervals-for-coefficients"><strong>Confidence intervals for  coefficients</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#goodness-of-fit"><strong>Goodness of fit</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#r-square"><strong>R-square</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusted-r-square"><strong>Adjusted R-square</strong></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#global-significance-test-anova"><strong>Global Significance Test (ANOVA)</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction"><strong>Prediction</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-selection"><strong>Predictors Selection</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#significance-test"><strong>Significance Test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#likelihood-ratio-test"><strong>Likelihood Ratio Test</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#predictors-selection-based-on-predictive-performance"><strong>Predictors selection based on predictive performance</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#train-train-train-validate-split"><strong>Train-Train - Train-Validate split</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#best-subset-selection-algorithm"><strong>Best subset selection algorithm</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-selection"><strong>Model selection</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-future-performance"><strong>Estimation of future performance</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-intervals"><strong>Prediction intervals</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-theory"><strong>Coefficient Interpretation: theory</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#without-interactions"><strong>Without interactions</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-quantitative-predictors"><strong>Interpretation of quantitative predictors</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-categorical-predictors"><strong>Interpretation of categorical predictors</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#with-interactions"><strong>With interactions</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#quantitative-predictors"><strong>Quantitative predictors:</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#categorical-predictors"><strong>Categorical predictors:</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coefficient-interpretation-application"><strong>Coefficient Interpretation: application</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-problems"><strong>Model Problems</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-model-assumptions"><strong>Violation of model assumptions</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-null-mean-of-the-residuals"><strong>Violation of null mean of the residuals</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-constant-variance-of-the-residuals"><strong>Violation of constant variance of the residuals</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-normality-of-the-residuals"><strong>Violation of Normality of the residuals</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#violation-of-null-auto-correlation-of-the-residuals"><strong>Violation of null auto-correlation of the residuals</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#multicollinearity"><strong>Multicollinearity</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#perfect-multicollinearity"><strong>Perfect Multicollinearity</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#high-multicollinearity"><strong>High Multicollinearity</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#multicollinearity-identification"><strong>Multicollinearity Identification</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#multicollinearity-identification-with-the-linear-correlation-matrix"><strong>Multicollinearity identification with the linear correlation matrix</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Fabio Scielzo Ortiz
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>